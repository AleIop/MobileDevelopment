{"ast":null,"code":"var _jsxFileName = \"/Users/Alessandro/Documents/GitHub/mobut-project/src/App.js\";\nimport React, { Component } from 'react';\nimport './App.css';\nimport { createFakeLobby, setPlayerReadyStatus, ListenToPlayersInLobby, addPlayerToLobby, removePlayerFromLobby, removePlayerFromGame, addPlayerToNewGame, getPlayersInLobby, createNewGame, stopListeningToLobby, ListenToPlayersInGame } from \"./components/firebase-database.component\";\nimport { signIn, initFirebaseAuth, signOut } from \"./components/firebase-authentication.component\";\nimport Lobby from './components/Lobby.js';\nimport Home from './components/Home.js';\nimport MapView from './components/MapView.js';\nimport { Toast, Modal } from 'react-onsenui';\nimport { BrowserRouter as Router, Route, Switch, Redirect } from 'react-router-dom';\n\nclass App extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      playersInGame: [],\n      playersInLobby: [],\n      lobbyPropsUpdate: false,\n      toast: {\n        open: false,\n        timeout: 2500,\n        message: ''\n      },\n      myLocation: {\n        lat: 0,\n        lng: 0\n      },\n      targetLocation: {\n        lat: 0,\n        lng: 0\n      },\n      user: {},\n      redirect: false,\n      path: \"/\",\n      huntingPlayer: null,\n      modalIsOpen: false,\n      stopCountDown: false,\n      a: false\n    };\n\n    this.authStateObserver = user => {\n      if (user) {\n        // User is signed in!,\n        this.setState({\n          user: this.getUserProps(user),\n          redirect: true,\n          path: '/lobby'\n        }); // console.log({ user }, ' signed in');\n      } else {\n        // User is signed out!\n        this.setState({\n          user: {}\n        }); // console.log({ user }, ' signed out');\n      }\n    };\n\n    this.getUserIndex = list => {\n      for (let i = 0; i < list.length; i++) {\n        const player = list[i];\n\n        if (player.id === this.state.user.id) {\n          return i;\n        }\n      }\n    };\n\n    this.getUserProps = user => {\n      // console.log('Current user: ', { user });\n      return {\n        email: user.email,\n        playerId: user.uid,\n        playerName: this.formatDisplayName(user.displayName),\n        imgURL: user.photoURL\n      };\n    };\n\n    this.formatDisplayName = name => {\n      let maxLength = 8;\n      let firstName = this.getFirstName(name);\n\n      if (firstName.length > maxLength) {\n        return `${firstName.slice(0, maxLength)}...`;\n      } else {\n        return firstName;\n      }\n    };\n\n    this.getFirstName = name => {\n      return name.split(\" \")[0];\n    };\n\n    this.playerInLobby = id => {\n      const allPlayers = this.state.playersInLobby;\n      let player;\n\n      for (let i = 0; i < allPlayers.length; i++) {\n        player = allPlayers[i];\n\n        if (player.playerId === id) {\n          return true;\n        }\n      }\n\n      return false;\n    };\n\n    this.playerInGame = id => {\n      const allPlayers = this.state.playersInGame;\n\n      if (allPlayers) {\n        let player;\n\n        for (let i = 0; i < allPlayers.length; i++) {\n          player = allPlayers[i];\n\n          if (player.playerId === id) {\n            return true;\n          }\n        }\n      }\n\n      return false;\n    };\n\n    this.updateToastMessage = message => {\n      let toast = this.state.toast;\n      toast[\"message\"] = message;\n      this.setState({\n        toast: toast\n      });\n    };\n\n    this.openToast = () => {\n      let toast = this.state.toast;\n      toast[\"open\"] = true;\n      this.setState({\n        toast: toast\n      });\n      setTimeout(() => {\n        toast[\"open\"] = false;\n        this.setState({\n          toast: toast\n        });\n      }, this.state.toast.timeout);\n    };\n\n    this.renderRedirect = () => {\n      if (this.state.redirect) {\n        return /*#__PURE__*/React.createElement(Redirect, {\n          push: true,\n          to: {\n            pathname: this.state.path,\n            state: {}\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 211,\n            columnNumber: 20\n          }\n        });\n      } else {\n        return /*#__PURE__*/React.createElement(React.Fragment, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 218,\n            columnNumber: 20\n          }\n        });\n      }\n    };\n\n    this.signOut = () => {\n      this.setState({\n        path: '/'\n      });\n      removePlayerFromLobby(this.state.user);\n      signOut();\n    };\n\n    this.clearState = () => {\n      this.setState({\n        huntingPlayer: null\n      });\n    };\n\n    this.setOpenModal = bool => {\n      this.setState({\n        modalIsOpen: bool\n      });\n    };\n\n    this.setStopCountDown = bool => {\n      console.log(\"setting the stop countdown to\" + bool);\n      this.setState({\n        stopCountDown: bool\n      });\n    };\n  }\n\n  componentWillUnmount() {\n    this.pubnub.unsubscribe({\n      channels: ['positionChannel']\n    });\n  }\n\n  componentDidMount() {\n    this.clearState();\n    ListenToPlayersInLobby(data => {\n      this.setState({\n        playersInLobby: data,\n        lobbyPropsUpdate: !this.state.lobbyPropsUpdate\n      });\n    }); // the way of Ale, He's so random\n\n    ListenToPlayersInGame(data => {\n      if (this.state.playersInGame.length >= 2 && data.length === 1) {\n        // Somebody won!\n        this.setState({\n          playersInGame: data,\n          // chasedByPlayer:\n          huntingPlayer: {},\n          gamePropsUpdate: !this.state.gamePropsUpdate\n        }); // if (this.playerInGame(this.state.user.playerId)) {\n      }\n\n      if (data.length >= 2) {\n        let targetPlayer = data[Math.floor(Math.random() * data.length)];\n\n        while (targetPlayer.playerId === this.state.user.playerId) {\n          targetPlayer = data[Math.floor(Math.random() * data.length)];\n        } // console.log('Player: ',\n        //         this.state.user,\n        //         '\\nTarget player: ',\n        //         {targetPlayer});\n\n\n        this.setState({\n          playersInGame: data,\n          // chasedByPlayer:\n          huntingPlayer: targetPlayer,\n          gamePropsUpdate: !this.state.gamePropsUpdate\n        });\n      } //console.log('object :>> ', data);\n\n    });\n    initFirebaseAuth(this.authStateObserver);\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"App\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 261,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Router, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 262,\n        columnNumber: 17\n      }\n    }, this.renderRedirect(), /*#__PURE__*/React.createElement(Route, {\n      exact: true,\n      render: ({\n        location\n      }) => /*#__PURE__*/React.createElement(Switch, {\n        location: location,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 265,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(Route, {\n        exact: true,\n        path: [\"/lobby\"],\n        render: props => {\n          const user = this.state.user;\n          const userInLobby = this.playerInLobby(user.playerId);\n          return /*#__PURE__*/React.createElement(Lobby, {\n            user: user,\n            userInLobby: userInLobby,\n            allPlayers: this.state.playersInLobby,\n            lobbyPropsUpdate: this.state.lobbyPropsUpdate,\n            updatePlayerReadyState: setPlayerReadyStatus,\n            addPlayerToLobbyFunc: addPlayerToLobby,\n            removePlayerFromLobbyFunc: removePlayerFromLobby,\n            updateToastMessage: this.updateToastMessage,\n            openToast: this.openToast,\n            debounceToast: this.state.toast.open,\n            signOut: this.signOut,\n            addPlayerToNewGame: addPlayerToNewGame,\n            stopCountDown: this.state.stopCountDown,\n            setStopCountDown: this.setStopCountDown,\n            location: props.location,\n            history: props.history,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 269,\n              columnNumber: 41\n            }\n          });\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 266,\n          columnNumber: 29\n        }\n      }), /*#__PURE__*/React.createElement(Route, {\n        exact: true,\n        path: [\"/map\"],\n        render: props => {\n          return /*#__PURE__*/React.createElement(MapView, {\n            user: this.state.user,\n            playersInGame: this.state.playersInGame,\n            huntingPlayer: this.state.huntingPlayer,\n            chasedByPlayer: this.state.chasedByPlayer,\n            publishMyLocation: this.publishMyLocation,\n            targetLocation: this.state.targetLocation,\n            openToast: this.openToast,\n            updateToastMessage: this.updateToastMessage,\n            debounceToast: this.state.toast.open,\n            playerInGame: this.playerInGame(this.state.user.playerId),\n            removePlayerFromGame: removePlayerFromGame,\n            setModal: this.setOpenModal,\n            renderRedirect: this.renderRedirect,\n            endGame: this.endGame,\n            setStopCountDown: this.setStopCountDown,\n            location: props.location,\n            history: props.history,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 289,\n              columnNumber: 41\n            }\n          });\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 288,\n          columnNumber: 29\n        }\n      }), /*#__PURE__*/React.createElement(Route, {\n        exact: true,\n        path: [\"/\", \"/index.html\", \"/*\"],\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 310,\n          columnNumber: 29\n        }\n      }, /*#__PURE__*/React.createElement(Home, {\n        signIn: signIn,\n        content: /*#__PURE__*/React.createElement(React.Fragment, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 314,\n            columnNumber: 41\n          }\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 311,\n          columnNumber: 33\n        }\n      }))),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 264,\n        columnNumber: 21\n      }\n    })), /*#__PURE__*/React.createElement(Modal, {\n      isOpen: this.state.modalIsOpen,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 322,\n        columnNumber: 17\n      }\n    }, \"This game is loading\"), /*#__PURE__*/React.createElement(Toast, {\n      isOpen: this.state.toast.open,\n      animation: \"fall\",\n      animationOptions: {\n        duration: 0.2,\n        delay: 0.4,\n        timing: 'ease-in'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 325,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 330,\n        columnNumber: 21\n      }\n    }, this.state.toast.message)));\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["/Users/Alessandro/Documents/GitHub/mobut-project/src/App.js"],"names":["React","Component","createFakeLobby","setPlayerReadyStatus","ListenToPlayersInLobby","addPlayerToLobby","removePlayerFromLobby","removePlayerFromGame","addPlayerToNewGame","getPlayersInLobby","createNewGame","stopListeningToLobby","ListenToPlayersInGame","signIn","initFirebaseAuth","signOut","Lobby","Home","MapView","Toast","Modal","BrowserRouter","Router","Route","Switch","Redirect","App","state","playersInGame","playersInLobby","lobbyPropsUpdate","toast","open","timeout","message","myLocation","lat","lng","targetLocation","user","redirect","path","huntingPlayer","modalIsOpen","stopCountDown","a","authStateObserver","setState","getUserProps","getUserIndex","list","i","length","player","id","email","playerId","uid","playerName","formatDisplayName","displayName","imgURL","photoURL","name","maxLength","firstName","getFirstName","slice","split","playerInLobby","allPlayers","playerInGame","updateToastMessage","openToast","setTimeout","renderRedirect","pathname","clearState","setOpenModal","bool","setStopCountDown","console","log","componentWillUnmount","pubnub","unsubscribe","channels","componentDidMount","data","gamePropsUpdate","targetPlayer","Math","floor","random","render","location","props","userInLobby","history","chasedByPlayer","publishMyLocation","endGame","duration","delay","timing"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport './App.css';\nimport {\n    createFakeLobby,\n    setPlayerReadyStatus,\n    ListenToPlayersInLobby,\n    addPlayerToLobby,\n    removePlayerFromLobby,\n    removePlayerFromGame,\n    addPlayerToNewGame,\n    getPlayersInLobby,\n    createNewGame,\n    stopListeningToLobby,\n    ListenToPlayersInGame,\n} from \"./components/firebase-database.component\";\nimport {\n    signIn,\n    initFirebaseAuth,\n    signOut\n} from \"./components/firebase-authentication.component\";\nimport Lobby from './components/Lobby.js';\nimport Home from './components/Home.js';\nimport MapView from './components/MapView.js';\nimport { Toast, Modal } from 'react-onsenui';\nimport { BrowserRouter as Router, Route, Switch, Redirect } from 'react-router-dom';\n\n\nclass App extends Component {\n\n\n\n    componentWillUnmount() {\n        this.pubnub.unsubscribe({\n            channels: ['positionChannel']\n        });\n    }\n\n\n    state = {\n        playersInGame: [],\n        playersInLobby: [],\n        lobbyPropsUpdate: false,\n        toast: {\n            open: false,\n            timeout: 2500,\n            message: ''\n        },\n        myLocation: {\n            lat: 0,\n            lng: 0\n        },\n        targetLocation: {\n            lat: 0,\n            lng: 0\n        },\n        user: {},\n        redirect: false,\n        path: \"/\",\n        huntingPlayer: null,\n        modalIsOpen: false,\n        stopCountDown: false,\n        a: false,\n    };\n\n    authStateObserver = (user) => {\n        if (user) { // User is signed in!,\n            this.setState({\n                user: this.getUserProps(user),\n                redirect: true,\n                path: '/lobby'\n            });\n            // console.log({ user }, ' signed in');\n        } else { // User is signed out!\n            this.setState({\n                user: {},\n            });\n            // console.log({ user }, ' signed out');\n        }\n    };\n\n    componentDidMount() {\n        this.clearState();\n\n        ListenToPlayersInLobby((data) => {\n            this.setState({\n                playersInLobby: data,\n                lobbyPropsUpdate: (!(this.state.lobbyPropsUpdate))\n            });\n        });\n\n        // the way of Ale, He's so random\n        ListenToPlayersInGame((data) => {\n            if (this.state.playersInGame.length >= 2 && data.length === 1) {\n                // Somebody won!\n                this.setState({\n                    playersInGame: data,\n                    // chasedByPlayer:\n                    huntingPlayer: {},\n                    gamePropsUpdate: (!(this.state.gamePropsUpdate))\n                });\n\n                // if (this.playerInGame(this.state.user.playerId)) {\n            }\n            if (data.length >= 2) {\n                let targetPlayer = data[Math.floor(Math.random() * data.length)];\n                while (targetPlayer.playerId === this.state.user.playerId) {\n                    targetPlayer = data[Math.floor(Math.random() * data.length)];\n                }\n\n                // console.log('Player: ',\n                //         this.state.user,\n                //         '\\nTarget player: ',\n                //         {targetPlayer});\n                this.setState({\n                    playersInGame: data,\n                    // chasedByPlayer:\n                    huntingPlayer: targetPlayer,\n                    gamePropsUpdate: (!(this.state.gamePropsUpdate))\n                });\n            }\n            //console.log('object :>> ', data);\n        });\n\n        initFirebaseAuth(this.authStateObserver);\n    }\n\n    getUserIndex = (list) => {\n        for (let i = 0; i < list.length; i++) {\n            const player = list[i];\n            if (player.id === this.state.user.id) {\n                return i;\n            }\n        }\n    };\n\n    getUserProps = (user) => {\n        // console.log('Current user: ', { user });\n        return {\n            email: user.email,\n            playerId: user.uid,\n            playerName: this.formatDisplayName(user.displayName),\n            imgURL: user.photoURL,\n        };\n    };\n\n    formatDisplayName = (name) => {\n        let maxLength = 8;\n        let firstName = this.getFirstName(name);\n        if (firstName.length > maxLength) {\n            return `${firstName.slice(0, maxLength)}...`;\n        } else {\n            return firstName;\n        }\n    };\n\n    getFirstName = (name) => {\n        return (name.split(\" \"))[0];\n    };\n\n    playerInLobby = (id) => {\n        const allPlayers = this.state.playersInLobby;\n        let player;\n        for (let i = 0; i < allPlayers.length; i++) {\n            player = allPlayers[i];\n            if (player.playerId === id) {\n                return true;\n            }\n        }\n        return false;\n    };\n\n    playerInGame = (id) => {\n        const allPlayers = this.state.playersInGame;\n        if (allPlayers) {\n            let player;\n            for (let i = 0; i < allPlayers.length; i++) {\n                player = allPlayers[i];\n                if (player.playerId === id) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    };\n\n\n    updateToastMessage = (message) => {\n        let toast = this.state.toast;\n        toast[\"message\"] = message;\n        this.setState({\n            toast: toast\n        })\n    };\n\n    openToast = () => {\n        let toast = this.state.toast;\n        toast[\"open\"] = true;\n        this.setState({\n            toast: toast\n        });\n        setTimeout(() => {\n            toast[\"open\"] = false;\n            this.setState({\n                toast: toast\n            });\n        }, this.state.toast.timeout)\n    };\n\n    renderRedirect = () => {\n        if (this.state.redirect) {\n            return <Redirect push to={{\n                pathname: this.state.path,\n                state: {\n\n                }\n            }} />\n        } else {\n            return <React.Fragment />\n        }\n    };\n\n    // Maybe not needed with the authStateObserver in componentDidMount\n    signOut = () => {\n        this.setState({\n            path: '/'\n        });\n        removePlayerFromLobby(this.state.user);\n        signOut();\n    };\n\n    // signIn = () => {\n    //     signIn().then(res => {\n    //         this.setState({\n    //             user: this.getUserProps(res.user),\n    //             page: 1,\n    //         })\n    //     });\n    // };\n\n    clearState = () => {\n        this.setState({\n            huntingPlayer: null,\n        })\n    };\n\n    setOpenModal = (bool) => {\n        this.setState({\n            modalIsOpen: bool\n        });\n    }\n\n    setStopCountDown = (bool) => {\n        console.log(\"setting the stop countdown to\" + bool);\n        this.setState({\n            stopCountDown: bool,\n        });\n    }\n\n    render() {\n        return (\n            <div className=\"App\">\n                <Router>\n                    {this.renderRedirect()}\n                    <Route exact render={({ location }) => (\n                        <Switch location={location}>\n                            <Route exact path={[\"/lobby\"]} render={props => {\n                                const user = this.state.user;\n                                const userInLobby = this.playerInLobby(user.playerId)\n                                return (<Lobby\n                                    user={user}\n                                    userInLobby={userInLobby}\n                                    allPlayers={this.state.playersInLobby}\n                                    lobbyPropsUpdate={this.state.lobbyPropsUpdate}\n                                    updatePlayerReadyState={setPlayerReadyStatus}\n                                    addPlayerToLobbyFunc={addPlayerToLobby}\n                                    removePlayerFromLobbyFunc={removePlayerFromLobby}\n                                    updateToastMessage={this.updateToastMessage}\n                                    openToast={this.openToast}\n                                    debounceToast={this.state.toast.open}\n                                    signOut={this.signOut}\n                                    addPlayerToNewGame={addPlayerToNewGame}\n                                    stopCountDown={this.state.stopCountDown}\n                                    setStopCountDown={this.setStopCountDown}\n                                    location={props.location}\n                                    history={props.history}\n                                />);\n                            }} />\n                            <Route exact path={[\"/map\"]} render={props => {\n                                return (<MapView\n                                    user={this.state.user}\n                                    playersInGame={this.state.playersInGame}\n                                    huntingPlayer={this.state.huntingPlayer}\n                                    chasedByPlayer={this.state.chasedByPlayer}\n                                    publishMyLocation={this.publishMyLocation}\n                                    targetLocation={this.state.targetLocation}\n                                    openToast={this.openToast}\n                                    updateToastMessage={this.updateToastMessage}\n                                    debounceToast={this.state.toast.open}\n                                    playerInGame={this.playerInGame(this.state.user.playerId)}\n                                    removePlayerFromGame={removePlayerFromGame}\n                                    setModal={this.setOpenModal}\n                                    renderRedirect={this.renderRedirect}\n                                    endGame={this.endGame}\n                                    setStopCountDown={this.setStopCountDown}\n                                    location={props.location}\n                                    history={props.history}\n                                />);\n                            }} />\n\n                            <Route exact path={[\"/\", \"/index.html\", \"/*\"]}>\n                                <Home\n                                    signIn={signIn}\n                                    content={\n                                        <React.Fragment>\n                                        </React.Fragment>\n                                    }\n                                />\n                            </Route>\n                        </Switch>\n                    )} />\n                </Router>\n                <Modal isOpen={this.state.modalIsOpen}>\n                    This game is loading\n                </Modal>\n                <Toast\n                    isOpen={this.state.toast.open}\n                    animation={\"fall\"}\n                    animationOptions={{ duration: 0.2, delay: 0.4, timing: 'ease-in' }}\n                >\n                    <span>{this.state.toast.message}</span>\n                </Toast>\n            </div>\n        );\n    }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}