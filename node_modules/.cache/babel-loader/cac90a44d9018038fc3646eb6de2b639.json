{"ast":null,"code":"import _classCallCheck from\"/Users/Alessandro/Documents/GitHub/mobut-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/Alessandro/Documents/GitHub/mobut-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/Alessandro/Documents/GitHub/mobut-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/Alessandro/Documents/GitHub/mobut-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import{Marker}from'google-maps-react';import getDistance from'geolib/es/getDistance';import mixColors from'../utils';import'./MapView.css';var COLD_COLOR='hsl(60,100%,100%)';var WARM_COLOR='hsl(0,100%,50%)';var COLD_DISTANCE=5000;var WARM_DISTANCE=20;var interval;export var PlayerMarker=/*#__PURE__*/function(_React$Component){_inherits(PlayerMarker,_React$Component);var _super=_createSuper(PlayerMarker);function PlayerMarker(){var _this;_classCallCheck(this,PlayerMarker);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.props={targetLocation:{}};_this.state={location:{}};_this.tagTarget=function(){_this.props.removePlayerFromGame(_this.props.huntingPlayer);if(_this.props.playersInGame.length===2){_this.props.displayToast(\"Congratulation! You Won!\");_this.props.endGame();}};return _this;}_createClass(PlayerMarker,[{key:\"updateLocation\",value:function updateLocation(loc){this.setState({location:{lat:loc.coords.latitude,lng:loc.coords.longitude}});this.props.map.panTo({lat:loc.coords.latitude,lng:loc.coords.longitude});console.log('PlayerMarker state: ',this.state,'\\nPlayerMarker props: ',this.props);//this.onLocationUpdate(loc);\n}},{key:\"onErrorGettingLocation\",value:function onErrorGettingLocation(err){console.log('Unable to get location',err);}},{key:\"project\",value:function project(loc){var google=this.props.google;var sinY=Math.sin(loc.lat*Math.PI/180);sinY=Math.min(Math.max(sinY,-0.9999),0.9999);return new google.maps.Point(256*(0.5+loc.lng/360),256*(0.5-Math.log((1+sinY)/(1-sinY))/(4*Math.PI)));}},{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;var gl=navigator.geolocation;var glOptions={enableHighAccuracy:true,timeout:15000,maximumAge:0};gl.watchPosition(this.updateLocation.bind(this),this.onErrorGettingLocation.bind(this),glOptions);interval=setInterval(function(){if(_this2.state.location.lat)_this2.props.publishMyLocation(_this2.state.location);console.log('My location is: ',_this2.state.location);},10000);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){console.log(\"PlayerMarker.js Component did unmount\");clearInterval(interval);}},{key:\"render\",value:function render(){console.log('Player marker rerendered!');var google=this.props.google;if(this.distanceToTarget>WARM_DISTANCE)return/*#__PURE__*/React.createElement(Marker,Object.assign({},this.props,{name:'Player',position:this.state.location,icon:{path:'M42,21.002L16.043,0v11.55H0v18.9h16.043V42L42,21.002L42,21.002z',anchor:new google.maps.Point(21,21),scale:1.5,strokeWeight:4,fillColor:this.proximityColor,fillOpacity:1,rotation:this.directionToTarget}}));else return/*#__PURE__*/React.createElement(Marker,Object.assign({},this.props,{name:'Player',position:this.state.location,icon:{path:google.maps.SymbolPath.CIRCLE,scale:50,strokeWeight:6,fillColor:this.proximityColor,fillOpacity:1},label:{text:'TAG',fontSize:'36px',fontWeight:'bold'},onClick:this.tagTarget}));}},{key:\"directionToTarget\",get:function get(){var pos=this.project(this.state.location);var targetPos=this.project(this.props.targetLocation);return Math.atan2(targetPos.y-pos.y,targetPos.x-pos.x)*180/Math.PI;}},{key:\"distanceToTarget\",get:function get(){return getDistance({latitude:''+this.state.location.lat,longitude:''+this.state.location.lng},{latitude:''+this.props.targetLocation.lat,longitude:''+this.props.targetLocation.lng});}},{key:\"proximityColor\",get:function get(){var d=Math.max(Math.min(this.distanceToTarget,COLD_DISTANCE),WARM_DISTANCE);var t=Math.sqrt((d-WARM_DISTANCE)/(COLD_DISTANCE-WARM_DISTANCE));return mixColors(WARM_COLOR,COLD_COLOR,t);}}]);return PlayerMarker;}(React.Component);export default PlayerMarker;","map":{"version":3,"sources":["/Users/Alessandro/Documents/GitHub/mobut-project/src/components/PlayerMarker.js"],"names":["React","Marker","getDistance","mixColors","COLD_COLOR","WARM_COLOR","COLD_DISTANCE","WARM_DISTANCE","interval","PlayerMarker","props","targetLocation","state","location","tagTarget","removePlayerFromGame","huntingPlayer","playersInGame","length","displayToast","endGame","loc","setState","lat","coords","latitude","lng","longitude","map","panTo","console","log","err","google","sinY","Math","sin","PI","min","max","maps","Point","gl","navigator","geolocation","glOptions","enableHighAccuracy","timeout","maximumAge","watchPosition","updateLocation","bind","onErrorGettingLocation","setInterval","publishMyLocation","clearInterval","distanceToTarget","path","anchor","scale","strokeWeight","fillColor","proximityColor","fillOpacity","rotation","directionToTarget","SymbolPath","CIRCLE","text","fontSize","fontWeight","pos","project","targetPos","atan2","y","x","d","t","sqrt","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Marker } from 'google-maps-react';\nimport getDistance from 'geolib/es/getDistance';\nimport mixColors from '../utils';\nimport './MapView.css';\n\nconst COLD_COLOR = 'hsl(60,100%,100%)';\nconst WARM_COLOR = 'hsl(0,100%,50%)';\nconst COLD_DISTANCE = 5000;\nconst WARM_DISTANCE = 20;\nvar interval;\n\nexport class PlayerMarker extends React.Component {\n  props = {\n    targetLocation: {}\n  };\n\n  state = {\n    location: {}\n  };\n\n  updateLocation(loc) {\n    this.setState({\n      location: {\n        lat: loc.coords.latitude,\n        lng: loc.coords.longitude\n      }\n    });\n    this.props.map.panTo({\n      lat: loc.coords.latitude,\n      lng: loc.coords.longitude\n    });\n\n    console.log('PlayerMarker state: ', this.state,\n      '\\nPlayerMarker props: ', this.props);\n    //this.onLocationUpdate(loc);\n  }\n\n  onErrorGettingLocation(err) {\n    console.log('Unable to get location', err);\n  }\n\n  project(loc) {\n    let google = this.props.google;\n\n    let sinY = Math.sin(loc.lat * Math.PI / 180);\n    sinY = Math.min(Math.max(sinY, -0.9999), 0.9999);\n\n    return new google.maps.Point(\n      256 * (0.5 + loc.lng / 360),\n      256 * (0.5 - Math.log((1 + sinY) / (1 - sinY)) / (4 * Math.PI))\n    );\n  }\n\n  get directionToTarget() {\n    let pos = this.project(this.state.location);\n    let targetPos = this.project(this.props.targetLocation);\n    return Math.atan2(targetPos.y - pos.y, targetPos.x - pos.x) * 180 / Math.PI;\n  }\n\n  get distanceToTarget() {\n    return getDistance({\n      latitude: '' + this.state.location.lat,\n      longitude: '' + this.state.location.lng\n    }, {\n      latitude: '' + this.props.targetLocation.lat,\n      longitude: '' + this.props.targetLocation.lng\n    });\n  }\n\n  get proximityColor() {\n    let d = Math.max(Math.min(this.distanceToTarget, COLD_DISTANCE), WARM_DISTANCE);\n    let t = Math.sqrt((d - WARM_DISTANCE) / (COLD_DISTANCE - WARM_DISTANCE));\n    return mixColors(WARM_COLOR, COLD_COLOR, t);\n  }\n\n  componentDidMount() {\n    let gl = navigator.geolocation;\n    const glOptions = {\n      enableHighAccuracy: true,\n      timeout: 15000,\n      maximumAge: 0\n    };\n    gl.watchPosition(\n      this.updateLocation.bind(this),\n      this.onErrorGettingLocation.bind(this),\n      glOptions\n    );\n\n    interval = setInterval(() => {\n      if (this.state.location.lat) this.props.publishMyLocation(this.state.location);\n      console.log('My location is: ', this.state.location);\n    }, 10000);\n  }\n\n  componentWillUnmount() {\n    console.log(\"PlayerMarker.js Component did unmount\");\n    clearInterval(interval);\n  }\n\n  tagTarget = () => {\n    this.props.removePlayerFromGame(this.props.huntingPlayer);\n    if (this.props.playersInGame.length === 2) {\n      this.props.displayToast(\"Congratulation! You Won!\");\n      this.props.endGame();\n    }\n  }\n\n  render() {\n    console.log('Player marker rerendered!');\n\n    let google = this.props.google;\n    if (this.distanceToTarget > WARM_DISTANCE)\n      return (\n        <Marker {...this.props}\n          name={'Player'}\n          position={this.state.location}\n          icon={{\n            path: 'M42,21.002L16.043,0v11.55H0v18.9h16.043V42L42,21.002L42,21.002z',\n            anchor: new google.maps.Point(21, 21),\n            scale: 1.5,\n            strokeWeight: 4,\n            fillColor: this.proximityColor,\n            fillOpacity: 1,\n            rotation: this.directionToTarget\n          }}\n        />\n      );\n    else\n      return (\n        <Marker {...this.props}\n          name={'Player'}\n          position={this.state.location}\n          icon={{\n            path: google.maps.SymbolPath.CIRCLE,\n            scale: 50,\n            strokeWeight: 6,\n            fillColor: this.proximityColor,\n            fillOpacity: 1,\n          }}\n          label={{\n            text: 'TAG',\n            fontSize: '36px',\n            fontWeight: 'bold'\n          }}\n          onClick={this.tagTarget}\n        />\n      );\n  }\n}\n\nexport default PlayerMarker;\n"]},"metadata":{},"sourceType":"module"}