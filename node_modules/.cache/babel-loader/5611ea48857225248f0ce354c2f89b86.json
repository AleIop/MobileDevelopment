{"ast":null,"code":"import _regeneratorRuntime from\"/Users/Alessandro/Documents/GitHub/mobut-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/Alessandro/Documents/GitHub/mobut-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import*as firebase from\"firebase/app\";import\"firebase/firestore\";var firebaseConfig={apiKey:\"AIzaSyBXCX1Bb5S3OeJSmPsGr9B2J6iS9LVs2pQ\",authDomain:\"mobut-project.firebaseapp.com\",databaseURL:\"https://mobut-project.firebaseio.com\",projectId:\"mobut-project\",storageBucket:\"mobut-project.appspot.com\",messagingSenderId:\"685766846531\",appId:\"1:685766846531:web:39b5f7b9d38e6c22fdccf6\"};// Initialize Firebase\nfirebase.initializeApp(firebaseConfig);// Listener for the players in the lobby\nvar lobbyListener;function addPlayerToLobby(player_name,url){var player_id=player_name.replace(/\\s/g,'_');return firebase.firestore().collection('lobby').doc(player_id).set({playerName:player_name,playerId:player_id,imgURL:url,ready:false}).catch(function(error){console.error('Error adding a player to the lobby',error);});}function stopListeningToLobby(){if(lobbyListener!==undefined){lobbyListener();}}function ListenToPlayersInLobby(callback){lobbyListener=firebase.firestore().collection(\"lobby\").onSnapshot(function(querySnapshot){var playersInLobby=[];querySnapshot.forEach(function(doc){playersInLobby.push(doc.data());});callback(playersInLobby);},function onError(error){console.error(\"Error listening to lobby: \",error);});}function getPlayersInLobby(){return _getPlayersInLobby.apply(this,arguments);}function _getPlayersInLobby(){_getPlayersInLobby=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var playersInLobby;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:playersInLobby=[];_context.next=3;return firebase.firestore().collection(\"lobby\").get().then(function(querySnapshot){querySnapshot.forEach(function(doc){playersInLobby.push(doc.data());});console.log({playersInLobby:playersInLobby});});case 3:return _context.abrupt(\"return\",playersInLobby);case 4:case\"end\":return _context.stop();}}},_callee);}));return _getPlayersInLobby.apply(this,arguments);}function getPlayersInGame(game_id){return firebase.firestore().collection(\"games\").doc(game_id).get();}function removePlayerFromLobby(player_id){firebase.firestore().collection(\"lobby\").doc(player_id).delete().then(function(){console.log(\"Player succesfully removed!\");}).catch(function(error){console.error(\"Error removing lobby: \",error);});}function removePlayerFromGame(game_id,player_id){getPlayersInGame(game_id).then(function(game){var players=game.players;var new_players=[];players.forEach(function(player){if(player.playerId!==player_id){new_players.push(player);}});firebase.firestore().collection('games').doc(game_id).set({players:new_players}).then(function(docRef){console.log(\"Successfully removed the player with id: \",player_id);}).catch(function(error){console.error('Error removing the player with id',player_id,\" error: \",error);});});}function removePlayersInLobby(playersInLobby){playersInLobby.forEach(function(player){removePlayerFromLobby(player.playerId);});}function addPlayersToNewGame(playersInLobby){firebase.firestore().collection('games').add({players:playersInLobby}).then(function(docRef){console.log(\"Successfully added players to newly created game with ID: \",docRef.id);return playersInLobby;}).catch(function(error){console.error('Error adding players to new game',error);});}function createNewGame(){return getPlayersInLobby().then(function(lobby){console.log('lobby :',lobby);var playersInLobby=[];lobby.forEach(function(doc){playersInLobby.push(doc.data());});console.log(\"players in lobby:\",playersInLobby);return playersInLobby;}).then(addPlayersToNewGame).then(removePlayersInLobby).catch(function(error){console.error(\"Error creating a new game:\",error);});}function setPlayerReadyStatus(player_id,status){firebase.firestore().collection('lobby').doc(player_id).update({ready:status}).catch(function(error){console.error('Error setting the player ready status',error);});}function createFakeLobby(){addPlayerToLobby(\"DJ COW\",'https://vignette.wikia.nocookie.net/pewdiepieminecraft/images/0/06/MushCow2.jpeg/revision/latest?cb=20190803151753');addPlayerToLobby(\"Bengt\",'https://vignette.wikia.nocookie.net/pewdiepieminecraft/images/e/e7/4C2C755B-FB01-4351-886E-077F5B03CF16.jpeg/revision/latest?cb=20190811175416');addPlayerToLobby(\"Sven\",'https://vignette.wikia.nocookie.net/pewdiepieminecraft/images/d/dd/Sven.png/revision/latest?cb=20191130204116');addPlayerToLobby(\"Sven's BF\",'https://vignette.wikia.nocookie.net/pewdiepieminecraft/images/b/ba/SvenYellow.jpeg/revision/latest?cb=20190814205003');addPlayerToLobby(\"Water Sheep\",'https://vignette.wikia.nocookie.net/pewdiepieminecraft/images/d/db/Water_Sheep%27s_Return.png/revision/latest?cb=20191129235246');addPlayerToLobby(\"Ulla Britta\",'https://vignette.wikia.nocookie.net/pewdiepieminecraft/images/6/6d/BCBBA22C-0452-4B35-8C67-52F8345D734F.jpeg/revision/latest?cb=20190805181119');addPlayerToLobby(\"Flip Flop\",'https://vignette.wikia.nocookie.net/pewdiepieminecraft/images/c/c7/Flip_Flop.jpeg/revision/latest?cb=20190922230718');}// TODO: any functions to handle the end of a game?\nexport{createNewGame,addPlayerToLobby,createFakeLobby,ListenToPlayersInLobby,getPlayersInLobby,setPlayerReadyStatus,stopListeningToLobby};","map":{"version":3,"sources":["/Users/Alessandro/Documents/GitHub/mobut-project/src/components/firebase-database.component.js"],"names":["firebase","firebaseConfig","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","initializeApp","lobbyListener","addPlayerToLobby","player_name","url","player_id","replace","firestore","collection","doc","set","playerName","playerId","imgURL","ready","catch","error","console","stopListeningToLobby","undefined","ListenToPlayersInLobby","callback","onSnapshot","querySnapshot","playersInLobby","forEach","push","data","onError","getPlayersInLobby","get","then","log","getPlayersInGame","game_id","removePlayerFromLobby","delete","removePlayerFromGame","game","players","new_players","player","docRef","removePlayersInLobby","addPlayersToNewGame","add","id","createNewGame","lobby","setPlayerReadyStatus","status","update","createFakeLobby"],"mappings":"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","sourcesContent":["import * as firebase from \"firebase/app\";\nimport \"firebase/firestore\";\n\nconst firebaseConfig = {\n    apiKey: \"AIzaSyBXCX1Bb5S3OeJSmPsGr9B2J6iS9LVs2pQ\",\n    authDomain: \"mobut-project.firebaseapp.com\",\n    databaseURL: \"https://mobut-project.firebaseio.com\",\n    projectId: \"mobut-project\",\n    storageBucket: \"mobut-project.appspot.com\",\n    messagingSenderId: \"685766846531\",\n    appId: \"1:685766846531:web:39b5f7b9d38e6c22fdccf6\"\n};\n\n// Initialize Firebase\nfirebase.initializeApp(firebaseConfig);\n\n// Listener for the players in the lobby\nlet lobbyListener;\n\nfunction addPlayerToLobby(player_name, url) {\n    let player_id = player_name.replace(/\\s/g, '_');\n\n    return firebase.firestore().collection('lobby').doc(player_id).set({\n        playerName: player_name,\n        playerId: player_id,\n        imgURL: url,\n        ready: false\n    })\n        .catch(function (error) {\n            console.error('Error adding a player to the lobby', error);\n        });\n}\n\nfunction stopListeningToLobby() {\n    if (lobbyListener !== undefined) {\n        lobbyListener();\n    }\n}\n\nfunction ListenToPlayersInLobby(callback) {\n    lobbyListener = firebase.firestore().collection(\"lobby\").onSnapshot(function (querySnapshot) {\n        var playersInLobby = [];\n        querySnapshot.forEach(function (doc) {\n            playersInLobby.push(doc.data());\n        });\n        callback(playersInLobby)\n    }, function onError(error) {\n        console.error(\"Error listening to lobby: \", error);\n    });\n}\n\nasync function getPlayersInLobby() {\n    var playersInLobby = [];\n    await firebase.firestore().collection(\"lobby\").get().then(querySnapshot => {\n        querySnapshot.forEach(function (doc) {\n            playersInLobby.push(doc.data());\n        });\n        console.log({playersInLobby});\n    });\n    return playersInLobby;\n}\n\nfunction getPlayersInGame(game_id) {\n    return firebase.firestore().collection(\"games\").doc(game_id).get();\n}\n\nfunction removePlayerFromLobby(player_id) {\n    firebase.firestore().collection(\"lobby\").doc(player_id).delete().then(function () {\n        console.log(\"Player succesfully removed!\");\n    }).catch(function (error) {\n        console.error(\"Error removing lobby: \", error);\n    });\n}\n\nfunction removePlayerFromGame(game_id, player_id) {\n\n    getPlayersInGame(game_id)\n        .then(function (game) {\n            let players = game.players;\n            let new_players = [];\n            players.forEach(player => {\n                if (player.playerId !== player_id) {\n                    new_players.push(player);\n                }\n            });\n            firebase.firestore().collection('games').doc(game_id).set({\n                players: new_players\n            })\n                .then(function (docRef) {\n                    console.log(\"Successfully removed the player with id: \", player_id);\n                })\n                .catch(function (error) {\n                    console.error('Error removing the player with id', player_id, \" error: \", error);\n                });\n        })\n}\n\n\nfunction removePlayersInLobby(playersInLobby) {\n    playersInLobby.forEach(function (player) {\n        removePlayerFromLobby(player.playerId);\n    });\n}\n\nfunction addPlayersToNewGame(playersInLobby) {\n    firebase.firestore().collection('games').add({\n        players: playersInLobby\n    })\n        .then(function (docRef) {\n            console.log(\"Successfully added players to newly created game with ID: \", docRef.id);\n            return playersInLobby;\n        })\n        .catch(function (error) {\n            console.error('Error adding players to new game', error);\n        });\n}\n\nfunction createNewGame() {\n    return getPlayersInLobby()\n        .then(function (lobby) {\n            console.log('lobby :', lobby);\n            var playersInLobby = [];\n            lobby.forEach(function (doc) {\n                playersInLobby.push(doc.data());\n            });\n            console.log(\"players in lobby:\", playersInLobby);\n            return playersInLobby;\n        })\n        .then(addPlayersToNewGame)\n        .then(removePlayersInLobby)\n        .catch(function (error) {\n            console.error(\"Error creating a new game:\", error);\n        });\n\n}\n\nfunction setPlayerReadyStatus(player_id, status) {\n    firebase.firestore().collection('lobby').doc(player_id).update({\n        ready: status\n    })\n        .catch(function (error) {\n            console.error('Error setting the player ready status', error);\n        });\n\n}\n\nfunction createFakeLobby() {\n    addPlayerToLobby(\"DJ COW\", 'https://vignette.wikia.nocookie.net/pewdiepieminecraft/images/0/06/MushCow2.jpeg/revision/latest?cb=20190803151753');\n    addPlayerToLobby(\"Bengt\", 'https://vignette.wikia.nocookie.net/pewdiepieminecraft/images/e/e7/4C2C755B-FB01-4351-886E-077F5B03CF16.jpeg/revision/latest?cb=20190811175416');\n    addPlayerToLobby(\"Sven\", 'https://vignette.wikia.nocookie.net/pewdiepieminecraft/images/d/dd/Sven.png/revision/latest?cb=20191130204116');\n    addPlayerToLobby(\"Sven's BF\", 'https://vignette.wikia.nocookie.net/pewdiepieminecraft/images/b/ba/SvenYellow.jpeg/revision/latest?cb=20190814205003');\n    addPlayerToLobby(\"Water Sheep\", 'https://vignette.wikia.nocookie.net/pewdiepieminecraft/images/d/db/Water_Sheep%27s_Return.png/revision/latest?cb=20191129235246');\n    addPlayerToLobby(\"Ulla Britta\", 'https://vignette.wikia.nocookie.net/pewdiepieminecraft/images/6/6d/BCBBA22C-0452-4B35-8C67-52F8345D734F.jpeg/revision/latest?cb=20190805181119');\n    addPlayerToLobby(\"Flip Flop\", 'https://vignette.wikia.nocookie.net/pewdiepieminecraft/images/c/c7/Flip_Flop.jpeg/revision/latest?cb=20190922230718');\n}\n\n\n// TODO: any functions to handle the end of a game?\n\n\n\n\n\n\nexport { createNewGame, addPlayerToLobby, createFakeLobby, ListenToPlayersInLobby, getPlayersInLobby, setPlayerReadyStatus, stopListeningToLobby };"]},"metadata":{},"sourceType":"module"}