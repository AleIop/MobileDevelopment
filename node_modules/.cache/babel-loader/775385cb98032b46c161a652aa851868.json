{"ast":null,"code":"import*as firebase from\"firebase/app\";import\"firebase/firestore\";var firebaseConfig={apiKey:\"AIzaSyBXCX1Bb5S3OeJSmPsGr9B2J6iS9LVs2pQ\",authDomain:\"mobut-project.firebaseapp.com\",databaseURL:\"https://mobut-project.firebaseio.com\",projectId:\"mobut-project\",storageBucket:\"mobut-project.appspot.com\",messagingSenderId:\"685766846531\",appId:\"1:685766846531:web:39b5f7b9d38e6c22fdccf6\"};// Initialize Firebase\nfirebase.initializeApp(firebaseConfig);// Listener for the players in the lobby\nvar lobbyListener;function addPlayerToLobby(player_id){return firebase.firestore().collection('lobby').doc(player_id).set({playerId:player_id,ready:false}).catch(function(error){console.error('Error adding a player to the lobby',error);});}function stopListeningToLobby(){if(lobbyListener!==undefined){lobbyListener();}}function ListenToPlayersInLobby(callback){lobbyListener=firebase.firestore().collection(\"lobby\").onSnapshot(function(querySnapshot){var playersInLobby=[];querySnapshot.forEach(function(doc){playersInLobby.push(doc.data());});callback(playersInLobby);},function onError(error){console.error(\"Error listening to lobby: \",error);});}function getPlayersInLobby(){return firebase.firestore().collection(\"lobby\").get();}function getPlayersInGame(game_id){return firebase.firestore().collection(\"games\").doc(game_id).get();}function removePlayerFromLobby(player_id){firebase.firestore().collection(\"lobby\").doc(player_id).delete().then(function(){console.log(\"Player succesfully removed!\");}).catch(function(error){console.error(\"Error removing lobby: \",error);});}function removePlayerFromGame(game_id,player_id){getPlayersInGame(game_id).then(function(game){var players=game.players;var new_players=[];players.forEach(function(player){if(player.playerId!==player_id){new_players.push(player);}});firebase.firestore().collection('games').doc(game_id).set({players:new_players}).then(function(docRef){console.log(\"Successfully removed the player with id: \",player_id);}).catch(function(error){console.error('Error removing the player with id',player_id,\" error: \",error);});});}function removePlayersInLobby(playersInLobby){playersInLobby.forEach(function(player){removePlayerFromLobby(player.playerId);});}function addPlayersToNewGame(playersInLobby){firebase.firestore().collection('games').add({players:playersInLobby}).then(function(docRef){console.log(\"Successfully added players to newly created game with ID: \",docRef.id);return playersInLobby;}).catch(function(error){console.error('Error adding players to new game',error);});}function createNewGame(){return getPlayersInLobby().then(function(lobby){console.log('lobby :',lobby);var playersInLobby=[];lobby.forEach(function(doc){playersInLobby.push(doc.data());});console.log(\"players in lobby:\",playersInLobby);return playersInLobby;}).then(addPlayersToNewGame).then(removePlayersInLobby).catch(function(error){console.error(\"Error creating a new game:\",error);});}function setPlayerReadyStatus(player_id,status){firebase.firestore().collection('lobby').doc(player_id).update({ready:status}).catch(function(error){console.error('Error setting the player ready status',error);});}function createFakeLobby(){addPlayerToLobby(\"Alessandro\");addPlayerToLobby(\"Hannes\");addPlayerToLobby(\"Oscar\");addPlayerToLobby(\"Ramtin\");}// TODO: any functions to handle the end of a game?\nexport{createNewGame,addPlayerToLobby,createFakeLobby,ListenToPlayersInLobby,getPlayersInLobby,setPlayerReadyStatus,stopListeningToLobby};","map":{"version":3,"sources":["/Users/Alessandro/Documents/GitHub/mobut-project/src/components/firebase-database.component.js"],"names":["firebase","firebaseConfig","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","initializeApp","lobbyListener","addPlayerToLobby","player_id","firestore","collection","doc","set","playerId","ready","catch","error","console","stopListeningToLobby","undefined","ListenToPlayersInLobby","callback","onSnapshot","querySnapshot","playersInLobby","forEach","push","data","onError","getPlayersInLobby","get","getPlayersInGame","game_id","removePlayerFromLobby","delete","then","log","removePlayerFromGame","game","players","new_players","player","docRef","removePlayersInLobby","addPlayersToNewGame","add","id","createNewGame","lobby","setPlayerReadyStatus","status","update","createFakeLobby"],"mappings":"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","sourcesContent":["import * as firebase from \"firebase/app\";\nimport \"firebase/firestore\";\n\nconst firebaseConfig = {\n    apiKey: \"AIzaSyBXCX1Bb5S3OeJSmPsGr9B2J6iS9LVs2pQ\",\n    authDomain: \"mobut-project.firebaseapp.com\",\n    databaseURL: \"https://mobut-project.firebaseio.com\",\n    projectId: \"mobut-project\",\n    storageBucket: \"mobut-project.appspot.com\",\n    messagingSenderId: \"685766846531\",\n    appId: \"1:685766846531:web:39b5f7b9d38e6c22fdccf6\"\n};\n\n// Initialize Firebase\nfirebase.initializeApp(firebaseConfig);\n\n// Listener for the players in the lobby\nlet lobbyListener;\n\nfunction addPlayerToLobby(player_id) {\n    return firebase.firestore().collection('lobby').doc(player_id).set({\n        playerId: player_id,\n        ready: false\n    })\n        .catch(function (error) {\n            console.error('Error adding a player to the lobby', error);\n        });\n}\n\nfunction stopListeningToLobby() {\n    if (lobbyListener !== undefined) {\n        lobbyListener();\n    }\n}\n\nfunction ListenToPlayersInLobby(callback) {\n    lobbyListener = firebase.firestore().collection(\"lobby\").onSnapshot(function (querySnapshot) {\n        var playersInLobby = [];\n        querySnapshot.forEach(function (doc) {\n            playersInLobby.push(doc.data());\n        });\n        callback(playersInLobby)\n    }, function onError(error) {\n        console.error(\"Error listening to lobby: \", error);\n    });\n}\n\nfunction getPlayersInLobby() {\n    return firebase.firestore().collection(\"lobby\").get();\n}\n\nfunction getPlayersInGame(game_id) {\n    return firebase.firestore().collection(\"games\").doc(game_id).get();\n}\n\nfunction removePlayerFromLobby(player_id) {\n    firebase.firestore().collection(\"lobby\").doc(player_id).delete().then(function () {\n        console.log(\"Player succesfully removed!\");\n    }).catch(function (error) {\n        console.error(\"Error removing lobby: \", error);\n    });\n}\n\nfunction removePlayerFromGame(game_id, player_id) {\n\n    getPlayersInGame(game_id)\n        .then(function (game) {\n            let players = game.players;\n            let new_players = [];\n            players.forEach(player => {\n                if (player.playerId !== player_id) {\n                    new_players.push(player);\n                }\n            });\n            firebase.firestore().collection('games').doc(game_id).set({\n                players: new_players\n            })\n                .then(function (docRef) {\n                    console.log(\"Successfully removed the player with id: \", player_id);\n                })\n                .catch(function (error) {\n                    console.error('Error removing the player with id', player_id, \" error: \", error);\n                });\n        })\n}\n\n\nfunction removePlayersInLobby(playersInLobby) {\n    playersInLobby.forEach(function (player) {\n        removePlayerFromLobby(player.playerId);\n    });\n}\n\nfunction addPlayersToNewGame(playersInLobby) {\n    firebase.firestore().collection('games').add({\n        players: playersInLobby\n    })\n        .then(function (docRef) {\n            console.log(\"Successfully added players to newly created game with ID: \", docRef.id);\n            return playersInLobby;\n        })\n        .catch(function (error) {\n            console.error('Error adding players to new game', error);\n        });\n}\n\nfunction createNewGame() {\n    return getPlayersInLobby()\n        .then(function (lobby) {\n            console.log('lobby :', lobby);\n            var playersInLobby = [];\n            lobby.forEach(function (doc) {\n                playersInLobby.push(doc.data());\n            });\n            console.log(\"players in lobby:\", playersInLobby);\n            return playersInLobby;\n        })\n        .then(addPlayersToNewGame)\n        .then(removePlayersInLobby)\n        .catch(function (error) {\n            console.error(\"Error creating a new game:\", error);\n        });\n\n}\n\nfunction setPlayerReadyStatus(player_id, status) {\n    firebase.firestore().collection('lobby').doc(player_id).update({\n        ready: status\n    })\n        .catch(function (error) {\n            console.error('Error setting the player ready status', error);\n        });\n\n}\n\nfunction createFakeLobby() {\n    addPlayerToLobby(\"Alessandro\");\n    addPlayerToLobby(\"Hannes\");\n    addPlayerToLobby(\"Oscar\");\n    addPlayerToLobby(\"Ramtin\");\n}\n\n\n// TODO: any functions to handle the end of a game?\n\n\n\n\n\n\nexport { createNewGame, addPlayerToLobby, createFakeLobby, ListenToPlayersInLobby, getPlayersInLobby, setPlayerReadyStatus, stopListeningToLobby };"]},"metadata":{},"sourceType":"module"}