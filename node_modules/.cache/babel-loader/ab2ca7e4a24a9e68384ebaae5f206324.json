{"ast":null,"code":"import _classCallCheck from\"/Users/Alessandro/Documents/GitHub/mobut-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/Alessandro/Documents/GitHub/mobut-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Users/Alessandro/Documents/GitHub/mobut-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/Alessandro/Documents/GitHub/mobut-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/Alessandro/Documents/GitHub/mobut-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import'./App.css';import{createFakeLobby,setPlayerReadyStatus,ListenToPlayersInLobby,addPlayerToLobby,removePlayerFromLobby,addPlayerToNewGame,getPlayersInLobby,createNewGame,stopListeningToLobby,ListenToPlayersInGame}from\"./components/firebase-database.component\";import{signIn,initFirebaseAuth,signOut}from\"./components/firebase-authentication.component\";import Lobby from'./components/Lobby.js';import Home from'./components/Home.js';import MapView from'./components/MapView.js';import{Toast}from'react-onsenui';import{BrowserRouter as Router,Route,Switch,Redirect}from'react-router-dom';import PubNubReact from'pubnub-react';var App=/*#__PURE__*/function(_Component){_inherits(App,_Component);var _super=_createSuper(App);function App(props){var _this;_classCallCheck(this,App);_this=_super.call(this,props);_this.publishMyLocation=function(loc){//console.log('this.props :>> ', this.state);\n//console.log('loc :>> ', loc);\n_this.pubnub.publish({message:{user:_this.state.user,userLocation:loc},channel:'positionChannel'});};_this.state={playersInLobby:[],lobbyPropsUpdate:false,toast:{open:false,timeout:2500,message:''},myLocation:{lat:0,lng:0},targetLocation:{lat:0,lng:0},user:{},redirect:false,path:\"/\"};_this.authStateObserver=function(user){if(user){// User is signed in!,\n_this.setState({user:_this.getUserProps(user),redirect:true,path:'/lobby'});// console.log({ user }, ' signed in');\n}else{// User is signed out!\n_this.setState({user:{}});// console.log({ user }, ' signed out');\n}};_this.getUserIndex=function(list){for(var i=0;i<list.length;i++){var player=list[i];if(player.id===_this.state.user.id){return i;}}};_this.getUserProps=function(user){// console.log('Current user: ', { user });\nreturn{email:user.email,playerId:user.uid,playerName:_this.formatDisplayName(user.displayName),imgURL:user.photoURL};};_this.formatDisplayName=function(name){var maxLength=8;var firstName=_this.getFirstName(name);if(firstName.length>maxLength){return\"\".concat(firstName.slice(0,maxLength),\"...\");}else{return firstName;}};_this.getFirstName=function(name){return name.split(\" \")[0];};_this.playerInLobby=function(id){var allPlayers=_this.state.playersInLobby;var player;for(var i=0;i<allPlayers.length;i++){player=allPlayers[i];if(player.playerId===id){return true;}}return false;};_this.updateToastMessage=function(message){var toast=_this.state.toast;toast[\"message\"]=message;_this.setState({toast:toast});};_this.openToast=function(){var toast=_this.state.toast;toast[\"open\"]=true;_this.setState({toast:toast});setTimeout(function(){toast[\"open\"]=false;_this.setState({toast:toast});},_this.state.toast.timeout);};_this.renderRedirect=function(){if(_this.state.redirect){return/*#__PURE__*/React.createElement(Redirect,{push:true,to:{pathname:_this.state.path,state:{}}});}else{return/*#__PURE__*/React.createElement(React.Fragment,null);}};_this.signOut=function(){_this.setState({path:'/'});removePlayerFromLobby(_this.state.user);signOut();};_this.pubnub=new PubNubReact({publishKey:'pub-c-c72ffc95-6f42-4bdf-8a95-04015fd20d32',subscribeKey:'sub-c-ea26bb44-92b6-11ea-8dc6-429c98eb9bb1'});_this.pubnub.init(_assertThisInitialized(_this));return _this;}_createClass(App,[{key:\"componentWillMount\",value:function componentWillMount(){// this.pubnub.getStatus((st) => {\n// });\n}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.pubnub.unsubscribe({channels:['positionChannel']});}},{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;this.pubnub.subscribe({channels:['positionChannel'],withPresence:true});// Listening to 'positionChannel'\nthis.pubnub.getMessage('positionChannel',function(msg){if(_this2.state.huntingPlayer.playerId===msg.message.user.playerId){console.log('msg :>> ',msg,'\\nstate :>> ',_this2.state);console.log('My target is: ',_this2.state.huntingPlayer);_this2.setState({targetLocation:msg.message.userLocation});}//console.log('from pubnub update this.state :>> ', this.state);\n});ListenToPlayersInLobby(function(data){_this2.setState({playersInLobby:data,lobbyPropsUpdate:!_this2.state.lobbyPropsUpdate});});// // the way of ramtin\n// ListenToPlayersInGame((data) => {\n//     let userIndex = this.getUserIndex(data); //returns index in players list of current user\n//     if (data.length >= 2) {\n//         let chasedIndex = userIndex - 1;\n//         let targetIndex = userIndex + 1;\n//         if (userIndex === data.length - 1) {\n//             targetIndex = 0;\n//         }\n//         if (userIndex === 0) {\n//             chasedIndex = data.length - 1;\n//         }\n//         console.log('Player name: ',\n//             this.state.user.displayName,\n//             '\\nPlayer index: ', \n//             {userIndex},\n//             \"\\n He's chasing: \",\n//             {targetIndex},\n//             \"\\n He's chased by: \",\n//             {chasedIndex});\n//         this.setState({\n//             playersInGame: data,\n//             chasedByPlayer: data[chasedIndex],\n//             huntingPlayer: data[targetIndex],\n//             gamePropsUpdate: (!(this.state.gamePropsUpdate))\n//         });\n//     }\n// });\n// the way of Ale, He's so random\nListenToPlayersInGame(function(data){if(data.length>=2){var targetPlayer=data[Math.floor(Math.random()*data.length)];while(targetPlayer.playerId===_this2.state.user.playerId){targetPlayer=data[Math.floor(Math.random()*data.length)];}// console.log('Player: ',\n//         this.state.user,\n//         '\\nTarget player: ', \n//         {targetPlayer});\n_this2.setState({playersInGame:data,// chasedByPlayer: \nhuntingPlayer:targetPlayer,gamePropsUpdate:!_this2.state.gamePropsUpdate});}});initFirebaseAuth(this.authStateObserver);}},{key:\"render\",// signIn = () => {\n//     signIn().then(res => {\n//         this.setState({\n//             user: this.getUserProps(res.user),\n//             page: 1,\n//         })\n//     });\n// };\nvalue:function render(){var _this3=this;return/*#__PURE__*/React.createElement(\"div\",{className:\"App\"},/*#__PURE__*/React.createElement(Router,null,this.renderRedirect(),/*#__PURE__*/React.createElement(Route,{exact:true,render:function render(_ref){var location=_ref.location;return/*#__PURE__*/React.createElement(Switch,{location:location},/*#__PURE__*/React.createElement(Route,{exact:true,path:[\"/lobby\"],render:function render(props){var user=_this3.state.user;var userInLobby=_this3.playerInLobby(user.playerId);return/*#__PURE__*/React.createElement(Lobby,{user:user,userInLobby:userInLobby,allPlayers:_this3.state.playersInLobby,lobbyPropsUpdate:_this3.state.lobbyPropsUpdate,updatePlayerReadyState:setPlayerReadyStatus,addPlayerToLobbyFunc:addPlayerToLobby,removePlayerFromLobbyFunc:removePlayerFromLobby,updateToastMessage:_this3.updateToastMessage,openToast:_this3.openToast,debounceToast:_this3.state.toast.open,signOut:_this3.signOut,addPlayerToNewGame:addPlayerToNewGame});}}),/*#__PURE__*/React.createElement(Route,{exact:true,path:[\"/map\"]},/*#__PURE__*/React.createElement(MapView,{user:_this3.state.user,playersInGame:_this3.state.playersInGame,huntingPlayer:_this3.state.huntingPlayer,chasedByPlayer:_this3.state.chasedByPlayer,publishMyLocation:_this3.publishMyLocation,targetLocation:_this3.state.targetLocation})),/*#__PURE__*/React.createElement(Route,{exact:true,path:[\"/\",\"/index.html\",\"/*\"]},/*#__PURE__*/React.createElement(Home,{signIn:signIn,content:/*#__PURE__*/React.createElement(React.Fragment,null)})));}})),/*#__PURE__*/React.createElement(Toast,{isOpen:this.state.toast.open,animation:\"fall\",animationOptions:{duration:0.2,delay:0.4,timing:'ease-in'}},/*#__PURE__*/React.createElement(\"span\",null,this.state.toast.message)));}}]);return App;}(Component);export default App;","map":{"version":3,"sources":["/Users/Alessandro/Documents/GitHub/mobut-project/src/App.js"],"names":["React","Component","createFakeLobby","setPlayerReadyStatus","ListenToPlayersInLobby","addPlayerToLobby","removePlayerFromLobby","addPlayerToNewGame","getPlayersInLobby","createNewGame","stopListeningToLobby","ListenToPlayersInGame","signIn","initFirebaseAuth","signOut","Lobby","Home","MapView","Toast","BrowserRouter","Router","Route","Switch","Redirect","PubNubReact","App","props","publishMyLocation","loc","pubnub","publish","message","user","state","userLocation","channel","playersInLobby","lobbyPropsUpdate","toast","open","timeout","myLocation","lat","lng","targetLocation","redirect","path","authStateObserver","setState","getUserProps","getUserIndex","list","i","length","player","id","email","playerId","uid","playerName","formatDisplayName","displayName","imgURL","photoURL","name","maxLength","firstName","getFirstName","slice","split","playerInLobby","allPlayers","updateToastMessage","openToast","setTimeout","renderRedirect","pathname","publishKey","subscribeKey","init","unsubscribe","channels","subscribe","withPresence","getMessage","msg","huntingPlayer","console","log","data","targetPlayer","Math","floor","random","playersInGame","gamePropsUpdate","location","userInLobby","chasedByPlayer","duration","delay","timing"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport './App.css';\nimport {\n    createFakeLobby,\n    setPlayerReadyStatus,\n    ListenToPlayersInLobby,\n    addPlayerToLobby,\n    removePlayerFromLobby,\n    addPlayerToNewGame,\n    getPlayersInLobby,\n    createNewGame,\n    stopListeningToLobby,\n    ListenToPlayersInGame,\n} from \"./components/firebase-database.component\";\nimport {\n    signIn,\n    initFirebaseAuth,\n    signOut\n} from \"./components/firebase-authentication.component\";\nimport Lobby from './components/Lobby.js';\nimport Home from './components/Home.js';\nimport MapView from './components/MapView.js';\nimport { Toast } from 'react-onsenui';\nimport { BrowserRouter as Router, Route, Switch, Redirect } from 'react-router-dom';\nimport PubNubReact from 'pubnub-react';\n\n\nclass App extends Component {\n\n\n    constructor(props) {\n        super(props);\n        this.pubnub = new PubNubReact({\n            publishKey: 'pub-c-c72ffc95-6f42-4bdf-8a95-04015fd20d32',\n            subscribeKey: 'sub-c-ea26bb44-92b6-11ea-8dc6-429c98eb9bb1'\n        });\n        this.pubnub.init(this);\n    }\n\n    componentWillMount() {\n        \n\n        // this.pubnub.getStatus((st) => {\n        // });\n    }\n\n\n    publishMyLocation = (loc) => {\n        //console.log('this.props :>> ', this.state);\n        //console.log('loc :>> ', loc);\n        this.pubnub.publish({\n            message: {\n                user: this.state.user,\n                userLocation: loc\n            },\n            channel: 'positionChannel'\n        });\n    }\n\n    componentWillUnmount() {\n        this.pubnub.unsubscribe({\n            channels: ['positionChannel']\n        });\n    }\n\n\n    state = {\n        playersInLobby: [],\n        lobbyPropsUpdate: false,\n        toast: {\n            open: false,\n            timeout: 2500,\n            message: ''\n        },\n        myLocation: {\n            lat: 0,\n            lng: 0\n        },\n        targetLocation: {\n            lat: 0,\n            lng: 0\n        },\n        user: {},\n        redirect: false,\n        path: \"/\",\n    };\n\n    authStateObserver = (user) => {\n        if (user) { // User is signed in!,\n            this.setState({\n                user: this.getUserProps(user),\n                redirect: true,\n                path: '/lobby'\n            });\n            // console.log({ user }, ' signed in');\n        } else { // User is signed out!\n            this.setState({\n                user: {},\n            });\n            // console.log({ user }, ' signed out');\n        }\n    };\n\n    componentDidMount() {\n        this.pubnub.subscribe({\n            channels: ['positionChannel'],\n            withPresence: true\n        });\n\n        // Listening to 'positionChannel'\n        this.pubnub.getMessage('positionChannel', (msg) => {\n            if (this.state.huntingPlayer.playerId === msg.message.user.playerId) {\n                console.log('msg :>> ', \n                    msg,\n                    '\\nstate :>> ',\n                    this.state);\n                console.log('My target is: ', this.state.huntingPlayer);\n                \n                this.setState({\n                    targetLocation: msg.message.userLocation,\n                })\n            }\n            //console.log('from pubnub update this.state :>> ', this.state);\n        });\n\n\n        ListenToPlayersInLobby((data) => {\n            this.setState({\n                playersInLobby: data,\n                lobbyPropsUpdate: (!(this.state.lobbyPropsUpdate))\n            });\n        });\n\n        // // the way of ramtin\n        // ListenToPlayersInGame((data) => {\n\n        //     let userIndex = this.getUserIndex(data); //returns index in players list of current user\n        //     if (data.length >= 2) {\n        //         let chasedIndex = userIndex - 1;\n        //         let targetIndex = userIndex + 1;\n        //         if (userIndex === data.length - 1) {\n        //             targetIndex = 0;\n        //         }\n        //         if (userIndex === 0) {\n        //             chasedIndex = data.length - 1;\n        //         }\n\n        //         console.log('Player name: ',\n        //             this.state.user.displayName,\n        //             '\\nPlayer index: ', \n        //             {userIndex},\n        //             \"\\n He's chasing: \",\n        //             {targetIndex},\n        //             \"\\n He's chased by: \",\n        //             {chasedIndex});\n\n        //         this.setState({\n        //             playersInGame: data,\n        //             chasedByPlayer: data[chasedIndex],\n        //             huntingPlayer: data[targetIndex],\n        //             gamePropsUpdate: (!(this.state.gamePropsUpdate))\n        //         });\n        //     }\n        // });\n\n        // the way of Ale, He's so random\n        ListenToPlayersInGame((data) => {\n            if (data.length >= 2) {\n                let targetPlayer = data[Math.floor(Math.random() * data.length)];\n                while (targetPlayer.playerId === this.state.user.playerId) {\n                    targetPlayer = data[Math.floor(Math.random() * data.length)];\n                }\n\n                // console.log('Player: ',\n                //         this.state.user,\n                //         '\\nTarget player: ', \n                //         {targetPlayer});\n\n                this.setState({\n                    playersInGame: data,\n                    // chasedByPlayer: \n                    huntingPlayer: targetPlayer,\n                    gamePropsUpdate: (!(this.state.gamePropsUpdate))\n                });\n            }\n        });\n\n        initFirebaseAuth(this.authStateObserver);\n    }\n\n    getUserIndex = (list) => {\n        for (let i = 0; i < list.length; i++) {\n            const player = list[i];\n            if (player.id === this.state.user.id) {\n                return i;\n            }\n        }\n    }\n\n    getUserProps = (user) => {\n        // console.log('Current user: ', { user });\n        return {\n            email: user.email,\n            playerId: user.uid,\n            playerName: this.formatDisplayName(user.displayName),\n            imgURL: user.photoURL,\n        };\n    };\n\n    formatDisplayName = (name) => {\n        let maxLength = 8;\n        let firstName = this.getFirstName(name);\n        if (firstName.length > maxLength) {\n            return `${firstName.slice(0, maxLength)}...`;\n        } else {\n            return firstName;\n        }\n    };\n\n    getFirstName = (name) => {\n        return (name.split(\" \"))[0];\n    };\n\n    playerInLobby = (id) => {\n        const allPlayers = this.state.playersInLobby;\n        let player;\n        for (let i = 0; i < allPlayers.length; i++) {\n            player = allPlayers[i];\n            if (player.playerId === id) {\n                return true;\n            }\n        }\n        return false;\n    };\n\n    updateToastMessage = (message) => {\n        let toast = this.state.toast;\n        toast[\"message\"] = message;\n        this.setState({\n            toast: toast\n        })\n    };\n\n    openToast = () => {\n        let toast = this.state.toast;\n        toast[\"open\"] = true;\n        this.setState({\n            toast: toast\n        });\n        setTimeout(() => {\n            toast[\"open\"] = false;\n            this.setState({\n                toast: toast\n            });\n        }, this.state.toast.timeout)\n    };\n\n    renderRedirect = () => {\n        if (this.state.redirect) {\n            return <Redirect push to={{\n                pathname: this.state.path,\n                state: {\n\n                }\n            }} />\n        } else {\n            return <React.Fragment />\n        }\n    };\n\n    // Maybe not needed with the authStateObserver in componentDidMount\n    signOut = () => {\n        this.setState({\n            path: '/'\n        });\n        removePlayerFromLobby(this.state.user);\n        signOut();\n    };\n\n    // signIn = () => {\n    //     signIn().then(res => {\n    //         this.setState({\n    //             user: this.getUserProps(res.user),\n    //             page: 1,\n    //         })\n    //     });\n    // };\n\n    render() {\n        return (\n            <div className=\"App\">\n                <Router>\n                    {this.renderRedirect()}\n                    <Route exact render={({ location }) => (\n                        <Switch location={location}>\n                            <Route exact path={[\"/lobby\"]} render={props => {\n                                const user = this.state.user;\n                                const userInLobby = this.playerInLobby(user.playerId)\n                                return (<Lobby\n                                    user={user}\n                                    userInLobby={userInLobby}\n                                    allPlayers={this.state.playersInLobby}\n                                    lobbyPropsUpdate={this.state.lobbyPropsUpdate}\n                                    updatePlayerReadyState={setPlayerReadyStatus}\n                                    addPlayerToLobbyFunc={addPlayerToLobby}\n                                    removePlayerFromLobbyFunc={removePlayerFromLobby}\n                                    updateToastMessage={this.updateToastMessage}\n                                    openToast={this.openToast}\n                                    debounceToast={this.state.toast.open}\n                                    signOut={this.signOut}\n                                    addPlayerToNewGame={addPlayerToNewGame}\n                                />);\n                            }} />\n                            <Route exact path={[\"/map\"]}>\n                                <MapView\n                                    user={this.state.user}\n                                    playersInGame={this.state.playersInGame}\n                                    huntingPlayer={this.state.huntingPlayer}\n                                    chasedByPlayer={this.state.chasedByPlayer}\n                                    publishMyLocation={this.publishMyLocation}\n                                    targetLocation={this.state.targetLocation}\n                                />\n                            </Route>\n                            <Route exact path={[\"/\", \"/index.html\", \"/*\"]}>\n                                <Home\n                                    signIn={signIn}\n                                    content={\n                                        <React.Fragment>\n                                        </React.Fragment>\n                                    }\n                                />\n                            </Route>\n                        </Switch>\n                    )} />\n                </Router>\n                <Toast\n                    isOpen={this.state.toast.open}\n                    animation={\"fall\"}\n                    animationOptions={{ duration: 0.2, delay: 0.4, timing: 'ease-in' }}\n                >\n                    <span>{this.state.toast.message}</span>\n                </Toast>\n            </div>\n        );\n    }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}