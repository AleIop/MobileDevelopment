{"ast":null,"code":"import _classCallCheck from\"/Users/Alessandro/Documents/GitHub/mobut-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/Alessandro/Documents/GitHub/mobut-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Users/Alessandro/Documents/GitHub/mobut-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/Alessandro/Documents/GitHub/mobut-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/Alessandro/Documents/GitHub/mobut-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import{Map,Marker,InfoWindow,GoogleApiWrapper}from'google-maps-react';import PlayerMarker from'./PlayerMarker.js';import'./MapView.css';import PubNubReact from'pubnub-react';import{Redirect}from'react-router-dom';export var MapView=/*#__PURE__*/function(_React$Component){_inherits(MapView,_React$Component);var _super=_createSuper(MapView);function MapView(props){var _this;_classCallCheck(this,MapView);_this=_super.call(this,props);_this.state={myLocation:{lat:0,lng:0},targetLocation:{lat:0,lng:0},redirect:false};_this.target=null;_this.publishMyLocation=function(loc){//console.log('this.props :>> ', this.state);\n//console.log('loc :>> ', loc);\n_this.pubnub.publish({message:{user:_this.props.user,userLocation:loc},channel:'positionChannel'});};_this.displayToast=function(message){_this.props.updateToastMessage(message);if(!_this.props.debounceToast){_this.props.openToast();}};_this.endGame=function(){_this.setState({redirect:true});};_this.renderRedirect=function(){if(_this.state.redirect){return/*#__PURE__*/React.createElement(Redirect,{push:true,to:{pathname:'/lobby',state:{}}});}else{return/*#__PURE__*/React.createElement(React.Fragment,null);}};_this.pubnub=new PubNubReact({publishKey:'pub-c-c72ffc95-6f42-4bdf-8a95-04015fd20d32',subscribeKey:'sub-c-ea26bb44-92b6-11ea-8dc6-429c98eb9bb1'});_this.pubnub.init(_assertThisInitialized(_this));return _this;}_createClass(MapView,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;window.onunload=function(){_this2.props.removePlayerFromGame(_this2.state.user);//TODO redirect to another component\n//enable user to get back in the game\n};window.onpopstate=function(){_this2.props.removePlayerFromGame(_this2.state.user);};this.pubnub.subscribe({channels:['positionChannel'],withPresence:true});// Listening to 'positionChannel'\nthis.pubnub.getMessage('positionChannel',function(msg){console.log('msg :>> ',msg,'\\nstate :>> ',_this2.state,'\\nProps: ',_this2.props);if(_this2.props.huntingPlayer.playerId===msg.message.user.playerId){_this2.setState({targetLocation:msg.message.userLocation});}});}},{key:\"componentDidUpdate\",value:function componentDidUpdate(previousProps){if(this.state.targetLocation.lat===0&&this.state.targetLocation.lng===0)this.props.setModal(true);else this.props.setModal(false);if(!this.props.playerInGame){this.displayToast(\"You lost!!!\");this.endGame();}if(previousProps.huntingPlayer!==this.props.huntingPlayer)console.log('Current props: ',this.props);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.props.removePlayerFromGame(this.props.user);}},{key:\"render\",value:function render(){var _this3=this;if(!this.props.loaded)return/*#__PURE__*/React.createElement(\"div\",null,\"Loading...\");return/*#__PURE__*/React.createElement(React.Fragment,null,this.renderRedirect(),/*#__PURE__*/React.createElement(Map,{google:this.props.google,zoom:14,initialCenter:{lat:59.329323,lng:18.068581}},/*#__PURE__*/React.createElement(Marker,Object.assign({},this.props,{ref:function ref(element){if(element)_this3.target=element.marker;},name:'Target',position:this.state.targetLocation})),/*#__PURE__*/React.createElement(PlayerMarker,{targetLocation:this.state.targetLocation,publishMyLocation:this.publishMyLocation,endGame:this.endGame,displayToast:this.displayToast})));}}]);return MapView;}(React.Component);export default GoogleApiWrapper({apiKey:'AIzaSyD-HO6pALPiY9nrniME6UmHy3P3YUCv2Eg'})(MapView);","map":{"version":3,"sources":["/Users/Alessandro/Documents/GitHub/mobut-project/src/components/MapView.js"],"names":["React","Map","Marker","InfoWindow","GoogleApiWrapper","PlayerMarker","PubNubReact","Redirect","MapView","props","state","myLocation","lat","lng","targetLocation","redirect","target","publishMyLocation","loc","pubnub","publish","message","user","userLocation","channel","displayToast","updateToastMessage","debounceToast","openToast","endGame","setState","renderRedirect","pathname","publishKey","subscribeKey","init","window","onunload","removePlayerFromGame","onpopstate","subscribe","channels","withPresence","getMessage","msg","console","log","huntingPlayer","playerId","previousProps","setModal","playerInGame","loaded","google","element","marker","Component","apiKey"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Map, Marker, InfoWindow, GoogleApiWrapper } from 'google-maps-react';\nimport PlayerMarker from './PlayerMarker.js';\nimport './MapView.css';\nimport PubNubReact from 'pubnub-react';\nimport { Redirect } from 'react-router-dom';\n\n\nexport class MapView extends React.Component {\n\n  state = {\n    myLocation: {\n      lat: 0,\n      lng: 0\n    },\n    targetLocation: {\n      lat: 0,\n      lng: 0\n    },\n    redirect: false,\n  }\n  target = null;\n\n  constructor(props) {\n    super(props);\n    this.pubnub = new PubNubReact({\n      publishKey: 'pub-c-c72ffc95-6f42-4bdf-8a95-04015fd20d32',\n      subscribeKey: 'sub-c-ea26bb44-92b6-11ea-8dc6-429c98eb9bb1'\n    });\n    this.pubnub.init(this);\n  }\n\n  componentDidMount(){\n    window.onunload = () => {\n      this.props.removePlayerFromGame(this.state.user);\n      //TODO redirect to another component\n      //enable user to get back in the game\n    };\n    window.onpopstate = () => {\n        this.props.removePlayerFromGame(this.state.user);\n    };\n\n    this.pubnub.subscribe({\n        channels: ['positionChannel'],\n        withPresence: true\n    });\n  \n    // Listening to 'positionChannel'\n    this.pubnub.getMessage('positionChannel', (msg) => {\n        console.log('msg :>> ',\n            msg,\n            '\\nstate :>> ',\n            this.state,\n            '\\nProps: ',\n            this.props);\n        if (this.props.huntingPlayer.playerId === msg.message.user.playerId) {\n            this.setState({\n                targetLocation: msg.message.userLocation,\n            });\n        }\n    });\n  }\n\n  publishMyLocation = (loc) => {\n    //console.log('this.props :>> ', this.state);\n    //console.log('loc :>> ', loc);\n    this.pubnub.publish({\n      message: {\n        user: this.props.user,\n        userLocation: loc\n      },\n      channel: 'positionChannel'\n    });\n  }\n\n  displayToast = (message) => {\n    this.props.updateToastMessage(message);\n    if (!(this.props.debounceToast)) {\n      this.props.openToast();\n    }\n  };\n\n\n  componentDidUpdate(previousProps) {\n    if (this.state.targetLocation.lat === 0 && this.state.targetLocation.lng === 0)\n      this.props.setModal(true);\n    else \n      this.props.setModal(false);\n\n    if (!this.props.playerInGame) {\n      this.displayToast(\"You lost!!!\");\n      this.endGame();\n    }\n    if (previousProps.huntingPlayer !== this.props.huntingPlayer) console.log('Current props: ', this.props);\n  }\n\n  componentWillUnmount() {\n    this.props.removePlayerFromGame(this.props.user);\n  }\n\n  endGame = () =>{\n    this.setState({ redirect: true });\n  }\n\n  renderRedirect = () => {\n    if (this.state.redirect) {\n      return <Redirect push to={{\n        pathname: '/lobby',\n        state: {\n\n        }\n      }} />\n    } else {\n      return <React.Fragment />\n    }\n  };\n\n\n  render() {\n    if (!this.props.loaded)\n      return (\n        <div>Loading...</div>\n      );\n\n    return (\n      <React.Fragment>\n        {this.renderRedirect()}\n        <Map\n          google={this.props.google}\n          zoom={14}\n          initialCenter={{\n            lat: 59.329323,\n            lng: 18.068581\n          }}\n        >\n          <Marker {...this.props}\n            ref={element => {\n              if (element)\n                this.target = element.marker;\n            }}\n            name={'Target'}\n            position={this.state.targetLocation}\n          />\n          <PlayerMarker\n            targetLocation={this.state.targetLocation}\n            publishMyLocation={this.publishMyLocation}\n            endGame={this.endGame}\n            displayToast={this.displayToast}\n          />\n        </Map>\n      </React.Fragment>\n    );\n  }\n}\n\nexport default GoogleApiWrapper({\n  apiKey: ('AIzaSyD-HO6pALPiY9nrniME6UmHy3P3YUCv2Eg')\n})(MapView)\n"]},"metadata":{},"sourceType":"module"}