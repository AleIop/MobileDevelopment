{"ast":null,"code":"var _jsxFileName = \"/Users/Alessandro/Documents/GitHub/mobut-project/src/components/PlayerMarker.js\";\nimport React from 'react';\nimport { Marker } from 'google-maps-react';\nimport getDistance from 'geolib/es/getDistance';\nimport mixColors from '../utils';\nimport './MapView.css';\nconst COLD_COLOR = 'hsl(60,100%,100%)';\nconst WARM_COLOR = 'hsl(0,100%,50%)';\nconst COLD_DISTANCE = 5000;\nconst WARM_DISTANCE = 10;\nvar interval;\nexport class PlayerMarker extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.props = {\n      targetLocation: {}\n    };\n    this.state = {\n      location: {}\n    };\n  }\n\n  updateLocation(loc) {\n    this.setState({\n      location: {\n        lat: loc.coords.latitude,\n        lng: loc.coords.longitude\n      }\n    });\n    this.props.map.panTo({\n      lat: loc.coords.latitude,\n      lng: loc.coords.longitude\n    }); //this.onLocationUpdate(loc);\n  }\n\n  onErrorGettingLocation(err) {\n    console.log('Unable to get location', err);\n  }\n\n  project(loc) {\n    let google = this.props.google;\n    let sinY = Math.sin(loc.lat * Math.PI / 180);\n    sinY = Math.min(Math.max(sinY, -0.9999), 0.9999);\n    return new google.maps.Point(256 * (0.5 + loc.lng / 360), 256 * (0.5 - Math.log((1 + sinY) / (1 - sinY)) / (4 * Math.PI)));\n  }\n\n  get directionToTarget() {\n    let pos = this.project(this.state.location);\n    let targetPos = this.project(this.props.targetLocation);\n    return Math.atan2(targetPos.y - pos.y, targetPos.x - pos.x) * 180 / Math.PI;\n  }\n\n  get distanceToTarget() {\n    return getDistance({\n      latitude: '' + this.state.location.lat,\n      longitude: '' + this.state.location.lng\n    }, {\n      latitude: '' + this.props.targetLocation.lat,\n      longitude: '' + this.props.targetLocation.lng\n    });\n  }\n\n  get proximityColor() {\n    let d = Math.max(Math.min(this.distanceToTarget, COLD_DISTANCE), WARM_DISTANCE);\n    let t = Math.sqrt((d - WARM_DISTANCE) / (COLD_DISTANCE - WARM_DISTANCE));\n    return mixColors(WARM_COLOR, COLD_COLOR, t);\n  }\n\n  componentDidMount() {\n    let gl = navigator.geolocation;\n    const glOptions = {\n      enableHighAccuracy: true,\n      timeout: 15000,\n      maximumAge: 0\n    };\n    gl.watchPosition(this.updateLocation.bind(this), this.onErrorGettingLocation.bind(this), glOptions);\n    interval = setInterval(() => {\n      this.props.publishMyLocation(this.state.location);\n      console.log('My target is: ', this.props.targetLocation, '\\nDistance to target: ', this.distanceToTarget);\n    }, 10000);\n  }\n\n  componentWillUnmount() {\n    clearInterval(interval);\n  }\n\n  render() {\n    let google = this.props.google;\n    return /*#__PURE__*/React.createElement(Marker, Object.assign({}, this.props, {\n      name: 'Player',\n      position: this.state.location,\n      icon: {\n        path: 'M42,21.002L16.043,0v11.55H0v18.9h16.043V42L42,21.002L42,21.002z',\n        anchor: new google.maps.Point(21, 21),\n        scale: 2,\n        strokeWeight: 6,\n        fillColor: this.proximityColor,\n        fillOpacity: 1,\n        rotation: this.directionToTarget\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 7\n      }\n    }));\n  }\n\n}\nexport default PlayerMarker;","map":{"version":3,"sources":["/Users/Alessandro/Documents/GitHub/mobut-project/src/components/PlayerMarker.js"],"names":["React","Marker","getDistance","mixColors","COLD_COLOR","WARM_COLOR","COLD_DISTANCE","WARM_DISTANCE","interval","PlayerMarker","Component","props","targetLocation","state","location","updateLocation","loc","setState","lat","coords","latitude","lng","longitude","map","panTo","onErrorGettingLocation","err","console","log","project","google","sinY","Math","sin","PI","min","max","maps","Point","directionToTarget","pos","targetPos","atan2","y","x","distanceToTarget","proximityColor","d","t","sqrt","componentDidMount","gl","navigator","geolocation","glOptions","enableHighAccuracy","timeout","maximumAge","watchPosition","bind","setInterval","publishMyLocation","componentWillUnmount","clearInterval","render","path","anchor","scale","strokeWeight","fillColor","fillOpacity","rotation"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Marker } from 'google-maps-react';\nimport getDistance from 'geolib/es/getDistance';\nimport mixColors from '../utils';\nimport './MapView.css';\n\nconst COLD_COLOR = 'hsl(60,100%,100%)';\nconst WARM_COLOR = 'hsl(0,100%,50%)';\nconst COLD_DISTANCE = 5000;\nconst WARM_DISTANCE = 10;\nvar interval;\n\nexport class PlayerMarker extends React.Component {\n  props = {\n    targetLocation: {}\n  };\n\n  state = {\n    location: {}\n  };\n\n  updateLocation(loc) {\n    this.setState({\n      location: {\n        lat: loc.coords.latitude,\n        lng: loc.coords.longitude\n      }\n    });\n    this.props.map.panTo({\n      lat: loc.coords.latitude,\n      lng: loc.coords.longitude\n    });\n    \n    //this.onLocationUpdate(loc);\n  }\n\n  onErrorGettingLocation(err) {\n    console.log('Unable to get location', err);\n  }\n\n  project(loc) {\n    let google = this.props.google;\n\n    let sinY = Math.sin(loc.lat * Math.PI / 180);\n    sinY = Math.min(Math.max(sinY, -0.9999), 0.9999);\n\n    return new google.maps.Point(\n      256 * (0.5 + loc.lng / 360),\n      256 * (0.5 - Math.log((1 + sinY) / (1 - sinY)) / (4 * Math.PI))\n    );\n  }\n\n  get directionToTarget() {\n    let pos = this.project(this.state.location);\n    let targetPos = this.project(this.props.targetLocation);\n    return Math.atan2(targetPos.y - pos.y, targetPos.x - pos.x) * 180 / Math.PI;\n  }\n\n  get distanceToTarget() {\n    return getDistance({\n      latitude: '' + this.state.location.lat,\n      longitude: '' + this.state.location.lng\n    }, {\n      latitude: '' + this.props.targetLocation.lat,\n      longitude: '' + this.props.targetLocation.lng\n    });\n  }\n\n  get proximityColor() {\n    let d = Math.max(Math.min(this.distanceToTarget, COLD_DISTANCE), WARM_DISTANCE);\n    let t = Math.sqrt((d - WARM_DISTANCE) / (COLD_DISTANCE - WARM_DISTANCE));\n    return mixColors(WARM_COLOR, COLD_COLOR, t);\n  }\n\n  componentDidMount() {\n    let gl = navigator.geolocation;\n    const glOptions = {\n      enableHighAccuracy: true,\n      timeout: 15000,\n      maximumAge: 0\n    };\n    gl.watchPosition(\n      this.updateLocation.bind(this),\n      this.onErrorGettingLocation.bind(this),\n      glOptions\n    );\n\n    interval = setInterval(() => {\n      this.props.publishMyLocation(this.state.location);\n      console.log('My target is: ', this.props.targetLocation,\n        '\\nDistance to target: ', this.distanceToTarget);\n    }, 10000);\n  }\n\n  componentWillUnmount(){\n    clearInterval(interval);\n  }\n\n  render() {\n    let google = this.props.google;\n    return (\n      <Marker {...this.props}\n        name={'Player'}\n        position={this.state.location}\n        icon={{\n          path: 'M42,21.002L16.043,0v11.55H0v18.9h16.043V42L42,21.002L42,21.002z',\n          anchor: new google.maps.Point(21, 21),\n          scale: 2,\n          strokeWeight: 6,\n          fillColor: this.proximityColor,\n          fillOpacity: 1,\n          rotation: this.directionToTarget\n        }}\n      />\n    );\n  }\n}\n\nexport default PlayerMarker;\n"]},"metadata":{},"sourceType":"module"}