{"ast":null,"code":"import _classCallCheck from\"/Users/Alessandro/Documents/GitHub/mobut-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/Alessandro/Documents/GitHub/mobut-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/Alessandro/Documents/GitHub/mobut-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/Alessandro/Documents/GitHub/mobut-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import'./App.css';import{createFakeLobby,setPlayerReadyStatus,ListenToPlayersInLobby,addPlayerToLobby,removePlayerFromLobby,removePlayerFromGame,addPlayerToNewGame,getPlayersInLobby,createNewGame,stopListeningToLobby,ListenToPlayersInGame}from\"./components/firebase-database.component\";import{signIn,initFirebaseAuth,signOut}from\"./components/firebase-authentication.component\";import Lobby from'./components/Lobby.js';import Home from'./components/Home.js';import MapView from'./components/MapView.js';import{Toast,Modal}from'react-onsenui';import{BrowserRouter as Router,Route,Switch,Redirect}from'react-router-dom';var App=/*#__PURE__*/function(_Component){_inherits(App,_Component);var _super=_createSuper(App);function App(){var _this;_classCallCheck(this,App);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={playersInGame:[],playersInLobby:[],lobbyPropsUpdate:false,toast:{open:false,timeout:2500,message:''},myLocation:{lat:0,lng:0},targetLocation:{lat:0,lng:0},user:{},redirect:false,path:\"/\",huntingPlayer:null,modalIsOpen:true};_this.authStateObserver=function(user){if(user){// User is signed in!,\n_this.setState({user:_this.getUserProps(user),redirect:true,path:'/lobby'});// console.log({ user }, ' signed in');\n}else{// User is signed out!\n_this.setState({user:{}});// console.log({ user }, ' signed out');\n}};_this.getUserIndex=function(list){for(var i=0;i<list.length;i++){var player=list[i];if(player.id===_this.state.user.id){return i;}}};_this.getUserProps=function(user){// console.log('Current user: ', { user });\nreturn{email:user.email,playerId:user.uid,playerName:_this.formatDisplayName(user.displayName),imgURL:user.photoURL};};_this.formatDisplayName=function(name){var maxLength=8;var firstName=_this.getFirstName(name);if(firstName.length>maxLength){return\"\".concat(firstName.slice(0,maxLength),\"...\");}else{return firstName;}};_this.getFirstName=function(name){return name.split(\" \")[0];};_this.playerInLobby=function(id){var allPlayers=_this.state.playersInLobby;var player;for(var i=0;i<allPlayers.length;i++){player=allPlayers[i];if(player.playerId===id){return true;}}return false;};_this.playerInGame=function(id){var allPlayers=_this.state.playersInGame;if(allPlayers){var player;for(var i=0;i<allPlayers.length;i++){player=allPlayers[i];if(player.playerId===id){return true;}}}return false;};_this.updateToastMessage=function(message){var toast=_this.state.toast;toast[\"message\"]=message;_this.setState({toast:toast});};_this.openToast=function(){var toast=_this.state.toast;toast[\"open\"]=true;_this.setState({toast:toast});setTimeout(function(){toast[\"open\"]=false;_this.setState({toast:toast});},_this.state.toast.timeout);};_this.renderRedirect=function(){if(_this.state.redirect){return/*#__PURE__*/React.createElement(Redirect,{push:true,to:{pathname:_this.state.path,state:{}}});}else{return/*#__PURE__*/React.createElement(React.Fragment,null);}};_this.signOut=function(){_this.setState({path:'/'});removePlayerFromLobby(_this.state.user);signOut();};_this.clearState=function(){_this.setState({huntingPlayer:null});};_this.setOpenModal=function(bool){_this.setState({modalIsOpen:bool});};return _this;}_createClass(App,[{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.pubnub.unsubscribe({channels:['positionChannel']});}},{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;this.clearState();ListenToPlayersInLobby(function(data){_this2.setState({playersInLobby:data,lobbyPropsUpdate:!_this2.state.lobbyPropsUpdate});});// the way of Ale, He's so random\nListenToPlayersInGame(function(data){if(_this2.state.playersInGame.length>=2&&data.length<2){// Somebody won!\n_this2.setState({playersInGame:data,// chasedByPlayer:\nhuntingPlayer:{},gamePropsUpdate:!_this2.state.gamePropsUpdate});}if(data.length>=2){var targetPlayer=data[Math.floor(Math.random()*data.length)];while(targetPlayer.playerId===_this2.state.user.playerId){targetPlayer=data[Math.floor(Math.random()*data.length)];}// console.log('Player: ',\n//         this.state.user,\n//         '\\nTarget player: ',\n//         {targetPlayer});\n_this2.setState({playersInGame:data,// chasedByPlayer:\nhuntingPlayer:targetPlayer,gamePropsUpdate:!_this2.state.gamePropsUpdate});}console.log('object :>> ',data);});initFirebaseAuth(this.authStateObserver);}},{key:\"render\",value:function render(){var _this3=this;return/*#__PURE__*/React.createElement(\"div\",{className:\"App\"},/*#__PURE__*/React.createElement(Router,null,this.renderRedirect(),/*#__PURE__*/React.createElement(Route,{exact:true,render:function render(_ref){var location=_ref.location;return/*#__PURE__*/React.createElement(Switch,{location:location},/*#__PURE__*/React.createElement(Route,{exact:true,path:[\"/lobby\"],render:function render(props){var user=_this3.state.user;var userInLobby=_this3.playerInLobby(user.playerId);return/*#__PURE__*/React.createElement(Lobby,{user:user,userInLobby:userInLobby,allPlayers:_this3.state.playersInLobby,lobbyPropsUpdate:_this3.state.lobbyPropsUpdate,updatePlayerReadyState:setPlayerReadyStatus,addPlayerToLobbyFunc:addPlayerToLobby,removePlayerFromLobbyFunc:removePlayerFromLobby,updateToastMessage:_this3.updateToastMessage,openToast:_this3.openToast,debounceToast:_this3.state.toast.open,signOut:_this3.signOut,addPlayerToNewGame:addPlayerToNewGame});}}),/*#__PURE__*/React.createElement(Route,{exact:true,path:[\"/map\"]},/*#__PURE__*/React.createElement(MapView,{user:_this3.state.user,playersInGame:_this3.state.playersInGame,huntingPlayer:_this3.state.huntingPlayer,chasedByPlayer:_this3.state.chasedByPlayer,publishMyLocation:_this3.publishMyLocation,targetLocation:_this3.state.targetLocation,openToast:_this3.openToast,updateToastMessage:_this3.updateToastMessage,debounceToast:_this3.state.toast.open,playerInGame:_this3.playerInGame(_this3.state.user.playerId),removePlayerFromGame:removePlayerFromGame,setModal:_this3.setOpenModal})),/*#__PURE__*/React.createElement(Route,{exact:true,path:[\"/\",\"/index.html\",\"/*\"]},/*#__PURE__*/React.createElement(Home,{signIn:signIn,content:/*#__PURE__*/React.createElement(React.Fragment,null)})));}})),/*#__PURE__*/React.createElement(Modal,{isOpen:this.state.modalIsOpen},\"This motherfucker is loading\"),/*#__PURE__*/React.createElement(Toast,{isOpen:this.state.toast.open,animation:\"fall\",animationOptions:{duration:0.2,delay:0.4,timing:'ease-in'}},/*#__PURE__*/React.createElement(\"span\",null,this.state.toast.message)));}}]);return App;}(Component);export default App;","map":{"version":3,"sources":["/Users/Alessandro/Documents/GitHub/mobut-project/src/App.js"],"names":["React","Component","createFakeLobby","setPlayerReadyStatus","ListenToPlayersInLobby","addPlayerToLobby","removePlayerFromLobby","removePlayerFromGame","addPlayerToNewGame","getPlayersInLobby","createNewGame","stopListeningToLobby","ListenToPlayersInGame","signIn","initFirebaseAuth","signOut","Lobby","Home","MapView","Toast","Modal","BrowserRouter","Router","Route","Switch","Redirect","App","state","playersInGame","playersInLobby","lobbyPropsUpdate","toast","open","timeout","message","myLocation","lat","lng","targetLocation","user","redirect","path","huntingPlayer","modalIsOpen","authStateObserver","setState","getUserProps","getUserIndex","list","i","length","player","id","email","playerId","uid","playerName","formatDisplayName","displayName","imgURL","photoURL","name","maxLength","firstName","getFirstName","slice","split","playerInLobby","allPlayers","playerInGame","updateToastMessage","openToast","setTimeout","renderRedirect","pathname","clearState","setOpenModal","bool","pubnub","unsubscribe","channels","data","gamePropsUpdate","targetPlayer","Math","floor","random","console","log","location","props","userInLobby","chasedByPlayer","publishMyLocation","duration","delay","timing"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport './App.css';\nimport {\n    createFakeLobby,\n    setPlayerReadyStatus,\n    ListenToPlayersInLobby,\n    addPlayerToLobby,\n    removePlayerFromLobby,\n    removePlayerFromGame,\n    addPlayerToNewGame,\n    getPlayersInLobby,\n    createNewGame,\n    stopListeningToLobby,\n    ListenToPlayersInGame,\n} from \"./components/firebase-database.component\";\nimport {\n    signIn,\n    initFirebaseAuth,\n    signOut\n} from \"./components/firebase-authentication.component\";\nimport Lobby from './components/Lobby.js';\nimport Home from './components/Home.js';\nimport MapView from './components/MapView.js';\nimport { Toast, Modal } from 'react-onsenui';\nimport { BrowserRouter as Router, Route, Switch, Redirect } from 'react-router-dom';\n\n\nclass App extends Component {\n\n\n\n    componentWillUnmount() {\n        this.pubnub.unsubscribe({\n            channels: ['positionChannel']\n        });\n    }\n\n\n    state = {\n        playersInGame: [],\n        playersInLobby: [],\n        lobbyPropsUpdate: false,\n        toast: {\n            open: false,\n            timeout: 2500,\n            message: ''\n        },\n        myLocation: {\n            lat: 0,\n            lng: 0\n        },\n        targetLocation: {\n            lat: 0,\n            lng: 0\n        },\n        user: {},\n        redirect: false,\n        path: \"/\",\n        huntingPlayer: null,\n        modalIsOpen: true\n    };\n\n    authStateObserver = (user) => {\n        if (user) { // User is signed in!,\n            this.setState({\n                user: this.getUserProps(user),\n                redirect: true,\n                path: '/lobby'\n            });\n            // console.log({ user }, ' signed in');\n        } else { // User is signed out!\n            this.setState({\n                user: {},\n            });\n            // console.log({ user }, ' signed out');\n        }\n    };\n\n    componentDidMount() {\n        this.clearState();\n\n        ListenToPlayersInLobby((data) => {\n            this.setState({\n                playersInLobby: data,\n                lobbyPropsUpdate: (!(this.state.lobbyPropsUpdate))\n            });\n        });\n\n        // the way of Ale, He's so random\n        ListenToPlayersInGame((data) => {\n            if (this.state.playersInGame.length >= 2 && data.length < 2) {\n                // Somebody won!\n                this.setState({\n                    playersInGame: data,\n                    // chasedByPlayer:\n                    huntingPlayer: {},\n                    gamePropsUpdate: (!(this.state.gamePropsUpdate))\n                });\n            }\n            if (data.length >= 2) {\n                let targetPlayer = data[Math.floor(Math.random() * data.length)];\n                while (targetPlayer.playerId === this.state.user.playerId) {\n                    targetPlayer = data[Math.floor(Math.random() * data.length)];\n                }\n\n                // console.log('Player: ',\n                //         this.state.user,\n                //         '\\nTarget player: ',\n                //         {targetPlayer});\n                this.setState({\n                    playersInGame: data,\n                    // chasedByPlayer:\n                    huntingPlayer: targetPlayer,\n                    gamePropsUpdate: (!(this.state.gamePropsUpdate))\n                });\n            }\n            console.log('object :>> ', data);\n        });\n\n        initFirebaseAuth(this.authStateObserver);\n    }\n\n    getUserIndex = (list) => {\n        for (let i = 0; i < list.length; i++) {\n            const player = list[i];\n            if (player.id === this.state.user.id) {\n                return i;\n            }\n        }\n    };\n\n    getUserProps = (user) => {\n        // console.log('Current user: ', { user });\n        return {\n            email: user.email,\n            playerId: user.uid,\n            playerName: this.formatDisplayName(user.displayName),\n            imgURL: user.photoURL,\n        };\n    };\n\n    formatDisplayName = (name) => {\n        let maxLength = 8;\n        let firstName = this.getFirstName(name);\n        if (firstName.length > maxLength) {\n            return `${firstName.slice(0, maxLength)}...`;\n        } else {\n            return firstName;\n        }\n    };\n\n    getFirstName = (name) => {\n        return (name.split(\" \"))[0];\n    };\n\n    playerInLobby = (id) => {\n        const allPlayers = this.state.playersInLobby;\n        let player;\n        for (let i = 0; i < allPlayers.length; i++) {\n            player = allPlayers[i];\n            if (player.playerId === id) {\n                return true;\n            }\n        }\n        return false;\n    };\n\n    playerInGame = (id) => {\n        const allPlayers = this.state.playersInGame;\n        if (allPlayers) {\n            let player;\n            for (let i = 0; i < allPlayers.length; i++) {\n                player = allPlayers[i];\n                if (player.playerId === id) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    };\n\n\n    updateToastMessage = (message) => {\n        let toast = this.state.toast;\n        toast[\"message\"] = message;\n        this.setState({\n            toast: toast\n        })\n    };\n\n    openToast = () => {\n        let toast = this.state.toast;\n        toast[\"open\"] = true;\n        this.setState({\n            toast: toast\n        });\n        setTimeout(() => {\n            toast[\"open\"] = false;\n            this.setState({\n                toast: toast\n            });\n        }, this.state.toast.timeout)\n    };\n\n    renderRedirect = () => {\n        if (this.state.redirect) {\n            return <Redirect push to={{\n                pathname: this.state.path,\n                state: {\n\n                }\n            }} />\n        } else {\n            return <React.Fragment />\n        }\n    };\n\n    // Maybe not needed with the authStateObserver in componentDidMount\n    signOut = () => {\n        this.setState({\n            path: '/'\n        });\n        removePlayerFromLobby(this.state.user);\n        signOut();\n    };\n\n    // signIn = () => {\n    //     signIn().then(res => {\n    //         this.setState({\n    //             user: this.getUserProps(res.user),\n    //             page: 1,\n    //         })\n    //     });\n    // };\n\n    clearState = () => {\n        this.setState({\n            huntingPlayer: null,\n        })\n    };\n\n    setOpenModal = (bool) => {\n        this.setState({\n            modalIsOpen: bool\n        });\n    }\n\n    render() {\n        return (\n            <div className=\"App\">\n                <Router>\n                    {this.renderRedirect()}\n                    <Route exact render={({ location }) => (\n                        <Switch location={location}>\n                            <Route exact path={[\"/lobby\"]} render={props => {\n                                const user = this.state.user;\n                                const userInLobby = this.playerInLobby(user.playerId)\n                                return (<Lobby\n                                    user={user}\n                                    userInLobby={userInLobby}\n                                    allPlayers={this.state.playersInLobby}\n                                    lobbyPropsUpdate={this.state.lobbyPropsUpdate}\n                                    updatePlayerReadyState={setPlayerReadyStatus}\n                                    addPlayerToLobbyFunc={addPlayerToLobby}\n                                    removePlayerFromLobbyFunc={removePlayerFromLobby}\n                                    updateToastMessage={this.updateToastMessage}\n                                    openToast={this.openToast}\n                                    debounceToast={this.state.toast.open}\n                                    signOut={this.signOut}\n                                    addPlayerToNewGame={addPlayerToNewGame}\n                                />);\n                            }} />\n                            <Route exact path={[\"/map\"]}>\n                                <MapView\n                                    user={this.state.user}\n                                    playersInGame={this.state.playersInGame}\n                                    huntingPlayer={this.state.huntingPlayer}\n                                    chasedByPlayer={this.state.chasedByPlayer}\n                                    publishMyLocation={this.publishMyLocation}\n                                    targetLocation={this.state.targetLocation}\n                                    openToast={this.openToast}\n                                    updateToastMessage={this.updateToastMessage}\n                                    debounceToast={this.state.toast.open}\n                                    playerInGame={this.playerInGame(this.state.user.playerId)}\n                                    removePlayerFromGame={removePlayerFromGame}\n                                    setModal = {this.setOpenModal}\n                                />\n                            </Route>\n                            <Route exact path={[\"/\", \"/index.html\", \"/*\"]}>\n                                <Home\n                                    signIn={signIn}\n                                    content={\n                                        <React.Fragment>\n                                        </React.Fragment>\n                                    }\n                                />\n                            </Route>\n                        </Switch>\n                    )} />\n                </Router>\n                <Modal isOpen={this.state.modalIsOpen}>\n                    This motherfucker is loading\n                </Modal>\n                <Toast\n                    isOpen={this.state.toast.open}\n                    animation={\"fall\"}\n                    animationOptions={{ duration: 0.2, delay: 0.4, timing: 'ease-in' }}\n                >\n                    <span>{this.state.toast.message}</span>\n                </Toast>\n            </div>\n        );\n    }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}