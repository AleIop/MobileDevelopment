{"ast":null,"code":"var _jsxFileName = \"/Users/Alessandro/Documents/GitHub/mobut-project/src/App.js\";\nimport React, { Component } from 'react';\nimport './App.css';\nimport { createFakeLobby, setPlayerReadyStatus, ListenToPlayersInLobby, addPlayerToLobby, removePlayerFromLobby, getPlayersInLobby, createNewGame, stopListeningToLobby } from \"./components/firebase-database.component\";\nimport { signIn, initFirebaseAuth, signOut } from \"./components/firebase-authentication.component\";\nimport Lobby from './components/Lobby.js';\nimport MapView from './components/MapView.js';\nimport Home from './components/Home.js';\nimport { Toast } from 'react-onsenui';\nimport { useHistory, BrowserRouter as Router, Switch, Route, Link, Redirect } from \"react-router-dom\";\n\nclass App extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      playersInLobby: [],\n      lobbyPropsUpdate: false,\n      page: 0,\n      toast: {\n        open: false,\n        timeout: 2500,\n        message: ''\n      },\n      redirect: true,\n      path: '/'\n    };\n\n    this.renderRedirect = () => {\n      if (this.state.redirect) return /*#__PURE__*/React.createElement(Redirect, {\n        push: true,\n        to: {\n          pathname: this.state.path,\n          state: {}\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 47,\n          columnNumber: 39\n        }\n      });\n    };\n\n    this.authStateObserver = user => {\n      if (user) {\n        // User is signed in!,\n        this.setState({\n          user: this.getUserProps(user),\n          page: 1\n        });\n        this.setState({\n          path: '/lobby',\n          redirect: true\n        });\n        console.log({\n          user\n        }, ' signed in');\n      } else {\n        // User is signed out!\n        this.setState({\n          user: {},\n          page: 0\n        });\n        this.setState({\n          path: '/',\n          redirect: true\n        });\n        console.log({\n          user\n        }, ' signed out');\n      }\n    };\n\n    this.getUserProps = user => {\n      console.log('Current user: ', {\n        user\n      });\n      return {\n        email: user.email,\n        playerId: user.uid,\n        playerName: this.formatDisplayName(user.displayName),\n        imgURL: user.photoURL\n      };\n    };\n\n    this.formatDisplayName = name => {\n      let maxLength = 8;\n      let firstName = this.getFirstName(name);\n\n      if (firstName.length > maxLength) {\n        return `${firstName.slice(0, maxLength)}...`;\n      } else {\n        return firstName;\n      }\n    };\n\n    this.getFirstName = name => {\n      return name.split(\" \")[0];\n    };\n\n    this.playerInLobby = id => {\n      const allPlayers = this.state.playersInLobby;\n      let player;\n\n      for (let i = 0; i < allPlayers.length; i++) {\n        player = allPlayers[i];\n\n        if (player.playerId === id) {\n          return true;\n        }\n      }\n\n      return false;\n    };\n\n    this.updateToastMessage = message => {\n      let toast = this.state.toast;\n      toast[\"message\"] = message;\n      this.setState({\n        toast: toast\n      });\n    };\n\n    this.openToast = () => {\n      let toast = this.state.toast;\n      toast[\"open\"] = true;\n      this.setState({\n        toast: toast\n      });\n      setTimeout(() => {\n        toast[\"open\"] = false;\n        this.setState({\n          toast: toast\n        });\n      }, this.state.toast.timeout);\n    };\n\n    this.signOut = () => {\n      signOut();\n    };\n  }\n\n  componentDidMount() {\n    this.signOut();\n    ListenToPlayersInLobby(data => {\n      this.setState({\n        playersInLobby: data,\n        lobbyPropsUpdate: !this.state.lobbyPropsUpdate\n      });\n    });\n    initFirebaseAuth(this.authStateObserver);\n  }\n\n  // signIn = () => {\n  //     signIn().then(res => {\n  //         this.setState({\n  //             user: this.getUserProps(res.user),\n  //             page: 1,\n  //         })\n  //     });\n  // };\n  render() {\n    console.log(\"Render App.js\");\n    let page;\n\n    if (this.state.page === 0) {\n      page = /*#__PURE__*/React.createElement(React.Fragment, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 157,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(Home, {\n        signIn: signIn,\n        content: /*#__PURE__*/React.createElement(React.Fragment, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 161,\n            columnNumber: 29\n          }\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 158,\n          columnNumber: 21\n        }\n      }));\n    } else if (this.state.page === 1) {\n      const user = this.state.user;\n      user[\"ready\"] = this.playerInLobby(user.playerId);\n      page = /*#__PURE__*/React.createElement(React.Fragment, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(Lobby, {\n        user: user,\n        allPlayers: this.state.playersInLobby,\n        lobbyPropsUpdate: this.state.lobbyPropsUpdate,\n        updatePlayerReadyState: setPlayerReadyStatus,\n        addPlayerToLobbyFunc: addPlayerToLobby,\n        removePlayerFromLobbyFunc: removePlayerFromLobby,\n        updateToastMessage: this.updateToastMessage,\n        openToast: this.openToast,\n        debounceToast: this.state.toast.open,\n        signOut: signOut,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 172,\n          columnNumber: 21\n        }\n      }));\n    }\n\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"App\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(React.Fragment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 188,\n        columnNumber: 15\n      }\n    }, this.renderRedirect(), /*#__PURE__*/React.createElement(Router, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(Switch, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 191,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Route, {\n      exact: true,\n      path: \"/\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 192,\n        columnNumber: 23\n      }\n    }, /*#__PURE__*/React.createElement(Home, {\n      signIn: signIn,\n      content: /*#__PURE__*/React.createElement(React.Fragment, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 29\n        }\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 25\n      }\n    })), /*#__PURE__*/React.createElement(Route, {\n      path: \"/lobby\",\n      render: props => {\n        return /*#__PURE__*/React.createElement(Lobby, {\n          user: this.state.user,\n          allPlayers: this.state.playersInLobby,\n          lobbyPropsUpdate: this.state.lobbyPropsUpdate,\n          updatePlayerReadyState: setPlayerReadyStatus,\n          addPlayerToLobbyFunc: addPlayerToLobby,\n          removePlayerFromLobbyFunc: removePlayerFromLobby,\n          updateToastMessage: this.updateToastMessage,\n          openToast: this.openToast,\n          debounceToast: this.state.toast.open,\n          signOut: signOut,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 200,\n            columnNumber: 32\n          }\n        });\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 199,\n        columnNumber: 23\n      }\n    }), /*#__PURE__*/React.createElement(Route, {\n      path: \"/map\",\n      component: MapView,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 23\n      }\n    }))), /*#__PURE__*/React.createElement(Toast, {\n      isOpen: this.state.toast.open,\n      animation: \"fall\",\n      animationOptions: {\n        duration: 0.2,\n        delay: 0.4,\n        timing: 'ease-in'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 21\n      }\n    }, this.state.toast.message))));\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["/Users/Alessandro/Documents/GitHub/mobut-project/src/App.js"],"names":["React","Component","createFakeLobby","setPlayerReadyStatus","ListenToPlayersInLobby","addPlayerToLobby","removePlayerFromLobby","getPlayersInLobby","createNewGame","stopListeningToLobby","signIn","initFirebaseAuth","signOut","Lobby","MapView","Home","Toast","useHistory","BrowserRouter","Router","Switch","Route","Link","Redirect","App","state","playersInLobby","lobbyPropsUpdate","page","toast","open","timeout","message","redirect","path","renderRedirect","pathname","authStateObserver","user","setState","getUserProps","console","log","email","playerId","uid","playerName","formatDisplayName","displayName","imgURL","photoURL","name","maxLength","firstName","getFirstName","length","slice","split","playerInLobby","id","allPlayers","player","i","updateToastMessage","openToast","setTimeout","componentDidMount","data","render","props","duration","delay","timing"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport './App.css';\nimport {\n    createFakeLobby,\n    setPlayerReadyStatus,\n    ListenToPlayersInLobby,\n    addPlayerToLobby,\n    removePlayerFromLobby,\n    getPlayersInLobby,\n    createNewGame,\n    stopListeningToLobby,\n} from \"./components/firebase-database.component\";\nimport {\n    signIn,\n    initFirebaseAuth,\n    signOut\n} from \"./components/firebase-authentication.component\";\nimport Lobby from './components/Lobby.js';\nimport MapView from './components/MapView.js';\nimport Home from './components/Home.js';\nimport { Toast } from 'react-onsenui';\nimport { \n  useHistory,\n  BrowserRouter as Router,\n  Switch,\n  Route,\n  Link,\n  Redirect\n} from \"react-router-dom\";\n\nclass App extends Component {\n\n    state = {\n        playersInLobby: [],\n        lobbyPropsUpdate: false,\n        page: 0,\n        toast: {\n            open: false,\n            timeout: 2500,\n            message: ''\n        },\n        redirect: true,\n        path: '/'\n    };\n\n    renderRedirect = () => {\n      if(this.state.redirect) return (<Redirect push to={{pathname: this.state.path, state: {}}}/>);\n    }\n\n    authStateObserver = (user) => {\n        if (user) { // User is signed in!,\n            this.setState({\n                user: this.getUserProps(user),\n                page: 1,\n            });\n            this.setState({path: '/lobby', redirect: true});\n            console.log({ user }, ' signed in');\n        } else { // User is signed out!\n            this.setState({\n                user: {},\n                page: 0,\n            });\n            this.setState({path: '/', redirect: true});\n            console.log({ user }, ' signed out');\n        }\n    }\n\n    componentDidMount() {\n        this.signOut();\n        ListenToPlayersInLobby((data) => {\n            this.setState({\n                playersInLobby: data,\n                lobbyPropsUpdate: (!(this.state.lobbyPropsUpdate))\n            });\n        });\n        initFirebaseAuth(this.authStateObserver);\n    }\n\n    getUserProps = (user) => {\n        console.log('Current user: ', { user });\n        return {\n            email: user.email,\n            playerId: user.uid,\n            playerName: this.formatDisplayName(user.displayName),\n            imgURL: user.photoURL,\n        };\n    };\n\n    formatDisplayName = (name) => {\n        let maxLength = 8;\n        let firstName = this.getFirstName(name);\n        if (firstName.length > maxLength) {\n            return `${firstName.slice(0, maxLength)}...`;\n        } else {\n            return firstName;\n        }\n    };\n\n    getFirstName = (name) => {\n        return (name.split(\" \"))[0];\n    };\n\n    playerInLobby = (id) => {\n        const allPlayers = this.state.playersInLobby;\n        let player;\n        for (let i = 0; i < allPlayers.length; i++) {\n            player = allPlayers[i];\n            if (player.playerId === id) {\n                return true;\n            }\n        }\n        return false;\n    };\n\n    updateToastMessage = (message) => {\n        let toast = this.state.toast;\n        toast[\"message\"] = message;\n        this.setState({\n            toast: toast\n        })\n    };\n\n    openToast = () => {\n        let toast = this.state.toast;\n        toast[\"open\"] = true;\n        this.setState({\n            toast: toast\n        });\n        setTimeout(() => {\n            toast[\"open\"] = false;\n            this.setState({\n                toast: toast\n            });\n        }, this.state.toast.timeout)\n    };\n\n    // Maybe not needed with the authStateObserver in componentDidMount\n     signOut = () => {\n        signOut();\n     };\n\n    // signIn = () => {\n    //     signIn().then(res => {\n    //         this.setState({\n    //             user: this.getUserProps(res.user),\n    //             page: 1,\n    //         })\n    //     });\n    // };\n\n    render() {\n        console.log(\"Render App.js\");\n\n        let page;\n        if (this.state.page === 0) {\n            page = (\n                <React.Fragment>\n                    <Home\n                        signIn={signIn}\n                        content={\n                            <React.Fragment>\n                            </React.Fragment>\n                        }\n                    />\n\n                </React.Fragment>)\n        } else if (this.state.page === 1) {\n            const user = this.state.user;\n            user[\"ready\"] = this.playerInLobby(user.playerId);\n            page = (\n                <React.Fragment>\n                    <Lobby\n                        user={user}\n                        allPlayers={this.state.playersInLobby}\n                        lobbyPropsUpdate={this.state.lobbyPropsUpdate}\n                        updatePlayerReadyState={setPlayerReadyStatus}\n                        addPlayerToLobbyFunc={addPlayerToLobby}\n                        removePlayerFromLobbyFunc={removePlayerFromLobby}\n                        updateToastMessage={this.updateToastMessage}\n                        openToast={this.openToast}\n                        debounceToast={this.state.toast.open}\n                        signOut={signOut}\n                    />\n                </React.Fragment>)\n        }\n        return (\n            <div className=\"App\">\n              <React.Fragment>\n                {this.renderRedirect()}\n                <Router>\n                    <Switch>\n                      <Route exact path='/'>\n                        <Home signIn={signIn}\n                        content={\n                            <React.Fragment>\n                            </React.Fragment>\n                        }/>\n                      </Route>\n                      <Route path='/lobby' render={(props) => {\n                        return <Lobby\n                          user={this.state.user}\n                          allPlayers={this.state.playersInLobby}\n                          lobbyPropsUpdate={this.state.lobbyPropsUpdate}\n                          updatePlayerReadyState={setPlayerReadyStatus}\n                          addPlayerToLobbyFunc={addPlayerToLobby}\n                          removePlayerFromLobbyFunc={removePlayerFromLobby}\n                          updateToastMessage={this.updateToastMessage}\n                          openToast={this.openToast}\n                          debounceToast={this.state.toast.open}\n                          signOut={signOut}\n                        />\n                      } }/>\n                      <Route path='/map' component={MapView} />\n                    </Switch>\n                </Router>\n                <Toast\n                    isOpen={this.state.toast.open}\n                    animation={\"fall\"}\n                    animationOptions={{ duration: 0.2, delay: 0.4, timing: 'ease-in' }}\n                >\n                    <span>{this.state.toast.message}</span>\n                </Toast>\n              </React.Fragment>\n                \n            </div>\n        );\n    }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}