{"ast":null,"code":"var _jsxFileName = \"/Users/Alessandro/Documents/GitHub/mobut-project/src/components/MapView.js\";\nimport React from 'react';\nimport { Map, Marker, InfoWindow, GoogleApiWrapper } from 'google-maps-react';\nimport PlayerMarker from './PlayerMarker.js';\nimport './MapView.css';\nimport PubNubReact from 'pubnub-react';\nimport { Redirect } from 'react-router-dom';\nexport class MapView extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      myLocation: {\n        lat: 0,\n        lng: 0\n      },\n      targetLocation: {\n        lat: 0,\n        lng: 0\n      }\n    };\n    this.target = null;\n\n    this.publishMyLocation = loc => {\n      //console.log('this.props :>> ', this.state);\n      //console.log('loc :>> ', loc);\n      this.pubnub.publish({\n        message: {\n          user: this.props.user,\n          userLocation: loc\n        },\n        channel: 'positionChannel'\n      });\n    };\n\n    this.displayToast = message => {\n      this.props.updateToastMessage(message);\n\n      if (!this.props.debounceToast) {\n        this.props.openToast();\n      }\n    };\n\n    this.endGame = () => {\n      this.setState({\n        redirect: true,\n        path: '/lobby'\n      });\n    };\n\n    this.renderRedirect = () => {\n      if (this.state.redirect) {\n        return /*#__PURE__*/React.createElement(Redirect, {\n          push: true,\n          to: {\n            pathname: this.state.path,\n            state: {}\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 125,\n            columnNumber: 14\n          }\n        });\n      } else {\n        return /*#__PURE__*/React.createElement(React.Fragment, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 132,\n            columnNumber: 14\n          }\n        });\n      }\n    };\n\n    this.pubnub = new PubNubReact({\n      publishKey: 'pub-c-c72ffc95-6f42-4bdf-8a95-04015fd20d32',\n      subscribeKey: 'sub-c-ea26bb44-92b6-11ea-8dc6-429c98eb9bb1'\n    });\n    this.pubnub.init(this);\n  }\n\n  componentDidMount() {\n    //ALE'S BRILLIANT IDEA\n    if (this.state.targetLocation.lat === 0 && this.state.targetLocation.lng === 0) this.props.setModal(true);else this.props.setModal(false);\n\n    window.onunload = () => {\n      this.props.removePlayerFromGame(this.state.user); //TODO redirect to another component\n      //enable user to get back in the game\n    };\n\n    window.onpopstate = () => {\n      this.props.removePlayerFromGame(this.state.user);\n    }; // if (this.props.location.state.redirected) {\n    //   this.props.setStopCountDown(true);\n    // }\n\n\n    this.pubnub.subscribe({\n      channels: ['positionChannel'],\n      withPresence: true\n    }); // Listening to 'positionChannel'\n\n    this.pubnub.getMessage('positionChannel', msg => {\n      if (this.props.huntingPlayer !== null) {\n        if (this.props.huntingPlayer.playerId === msg.message.user.playerId) {\n          this.setState({\n            targetLocation: msg.message.userLocation\n          });\n        }\n      }\n    });\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (this.state.targetLocation.lat !== prevState.targetLocation.lat || this.state.targetLocation.lng !== prevState.targetLocation.lng) {\n      if (this.state.targetLocation.lat === 0 && this.state.targetLocation.lng === 0) this.props.setModal(true);else this.props.setModal(false);\n    } // if (this.props.huntingPlayer === null) {\n    //   this.props.setModal(true);\n    // } else {\n    //   this.props.setModal(false);\n    // }\n\n\n    if (this.props.playerInGame !== prevProps.playerInGame) {\n      if (!this.props.playerInGame) {\n        this.displayToast(\"You lost!!!\");\n        this.endGame();\n      }\n    }\n\n    if (prevProps.huntingPlayer !== this.props.huntingPlayer) console.log('Current props: ', this.props);\n  }\n\n  componentWillUnmount() {\n    this.props.removePlayerFromGame(this.props.user);\n  }\n\n  render() {\n    if (!this.props.loaded) return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 9\n      }\n    }, \"Loading...\");\n    return /*#__PURE__*/React.createElement(React.Fragment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 7\n      }\n    }, this.renderRedirect(), /*#__PURE__*/React.createElement(Map, {\n      google: this.props.google,\n      zoom: 14,\n      initialCenter: {\n        lat: 59.329323,\n        lng: 18.068581\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Marker, Object.assign({}, this.props, {\n      ref: element => {\n        if (element) this.target = element.marker;\n      },\n      name: 'Target',\n      position: this.state.targetLocation,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 11\n      }\n    })), /*#__PURE__*/React.createElement(PlayerMarker, {\n      targetLocation: this.state.targetLocation,\n      publishMyLocation: this.publishMyLocation,\n      endGame: this.endGame,\n      displayToast: this.displayToast,\n      removePlayerFromGame: this.props.removePlayerFromGame,\n      huntingPlayer: this.props.huntingPlayer,\n      playersInGame: this.props.playersInGame,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 11\n      }\n    })));\n  }\n\n}\nexport default GoogleApiWrapper({\n  apiKey: 'AIzaSyD-HO6pALPiY9nrniME6UmHy3P3YUCv2Eg'\n})(MapView);","map":{"version":3,"sources":["/Users/Alessandro/Documents/GitHub/mobut-project/src/components/MapView.js"],"names":["React","Map","Marker","InfoWindow","GoogleApiWrapper","PlayerMarker","PubNubReact","Redirect","MapView","Component","constructor","props","state","myLocation","lat","lng","targetLocation","target","publishMyLocation","loc","pubnub","publish","message","user","userLocation","channel","displayToast","updateToastMessage","debounceToast","openToast","endGame","setState","redirect","path","renderRedirect","pathname","publishKey","subscribeKey","init","componentDidMount","setModal","window","onunload","removePlayerFromGame","onpopstate","subscribe","channels","withPresence","getMessage","msg","huntingPlayer","playerId","componentDidUpdate","prevProps","prevState","playerInGame","console","log","componentWillUnmount","render","loaded","google","element","marker","playersInGame","apiKey"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Map, Marker, InfoWindow, GoogleApiWrapper } from 'google-maps-react';\nimport PlayerMarker from './PlayerMarker.js';\nimport './MapView.css';\nimport PubNubReact from 'pubnub-react';\nimport { Redirect } from 'react-router-dom';\n\n\nexport class MapView extends React.Component {\n\n  state = {\n    myLocation: {\n      lat: 0,\n      lng: 0\n    },\n    targetLocation: {\n      lat: 0,\n      lng: 0\n    },\n  }\n  target = null;\n\n  constructor(props) {\n    super(props);\n    this.pubnub = new PubNubReact({\n      publishKey: 'pub-c-c72ffc95-6f42-4bdf-8a95-04015fd20d32',\n      subscribeKey: 'sub-c-ea26bb44-92b6-11ea-8dc6-429c98eb9bb1'\n    });\n    this.pubnub.init(this);\n  }\n\n  componentDidMount() {\n    //ALE'S BRILLIANT IDEA\n    if (this.state.targetLocation.lat === 0 && this.state.targetLocation.lng === 0)\n      this.props.setModal(true);\n    else\n      this.props.setModal(false);\n\n    window.onunload = () => {\n      this.props.removePlayerFromGame(this.state.user);\n      //TODO redirect to another component\n      //enable user to get back in the game\n    };\n    window.onpopstate = () => {\n      this.props.removePlayerFromGame(this.state.user);\n    };\n    // if (this.props.location.state.redirected) {\n    //   this.props.setStopCountDown(true);\n    // }\n\n\n    this.pubnub.subscribe({\n      channels: ['positionChannel'],\n      withPresence: true\n    });\n\n    // Listening to 'positionChannel'\n    this.pubnub.getMessage('positionChannel', (msg) => {\n      if (this.props.huntingPlayer !== null) {\n        if (this.props.huntingPlayer.playerId === msg.message.user.playerId) {\n          this.setState({\n            targetLocation: msg.message.userLocation,\n          });\n        }\n      }\n    });\n  }\n\n  publishMyLocation = (loc) => {\n    //console.log('this.props :>> ', this.state);\n    //console.log('loc :>> ', loc);\n    this.pubnub.publish({\n      message: {\n        user: this.props.user,\n        userLocation: loc\n      },\n      channel: 'positionChannel'\n    });\n  };\n\n  displayToast = (message) => {\n    this.props.updateToastMessage(message);\n    if (!(this.props.debounceToast)) {\n      this.props.openToast();\n    }\n  };\n\n\n  componentDidUpdate(prevProps, prevState) {\n    if (this.state.targetLocation.lat !== prevState.targetLocation.lat || this.state.targetLocation.lng !== prevState.targetLocation.lng) {\n      if (this.state.targetLocation.lat === 0 && this.state.targetLocation.lng === 0)\n        this.props.setModal(true);\n      else\n        this.props.setModal(false);\n    }\n\n    // if (this.props.huntingPlayer === null) {\n    //   this.props.setModal(true);\n    // } else {\n    //   this.props.setModal(false);\n    // }\n\n    if (this.props.playerInGame !== prevProps.playerInGame) {\n      if (!this.props.playerInGame) {\n        this.displayToast(\"You lost!!!\");\n        this.endGame();\n      }\n    }\n    if (prevProps.huntingPlayer !== this.props.huntingPlayer) console.log('Current props: ', this.props);\n  }\n\n  componentWillUnmount() {\n    this.props.removePlayerFromGame(this.props.user);\n  }\n\n  endGame = () => {\n    this.setState({\n      redirect: true,\n      path: '/lobby'\n    });\n  };\n\n  renderRedirect = () => {\n    if (this.state.redirect) {\n      return <Redirect push to={{\n        pathname: this.state.path,\n        state: {\n\n        }\n      }} />\n    } else {\n      return <React.Fragment />\n    }\n  };\n  \n\n  render() {\n    if (!this.props.loaded)\n      return (\n        <div>Loading...</div>\n      );\n\n    return (\n      <React.Fragment>\n        {this.renderRedirect()}\n        <Map\n          google={this.props.google}\n          zoom={14}\n          initialCenter={{\n            lat: 59.329323,\n            lng: 18.068581\n          }}\n        >\n          <Marker {...this.props}\n            ref={element => {\n              if (element)\n                this.target = element.marker;\n            }}\n            name={'Target'}\n            position={this.state.targetLocation}\n          />\n          <PlayerMarker\n            targetLocation={this.state.targetLocation}\n            publishMyLocation={this.publishMyLocation}\n            endGame={this.endGame}\n            displayToast={this.displayToast}\n            removePlayerFromGame={this.props.removePlayerFromGame}\n            huntingPlayer={this.props.huntingPlayer}\n            playersInGame={this.props.playersInGame}\n          />\n        </Map>\n      </React.Fragment>\n    );\n  }\n}\n\nexport default GoogleApiWrapper({\n  apiKey: ('AIzaSyD-HO6pALPiY9nrniME6UmHy3P3YUCv2Eg')\n})(MapView)\n"]},"metadata":{},"sourceType":"module"}