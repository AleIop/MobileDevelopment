{"ast":null,"code":"import _classCallCheck from\"/Users/Alessandro/Documents/GitHub/mobut-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/Alessandro/Documents/GitHub/mobut-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Users/Alessandro/Documents/GitHub/mobut-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/Alessandro/Documents/GitHub/mobut-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/Alessandro/Documents/GitHub/mobut-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import{Map,Marker,InfoWindow,GoogleApiWrapper}from'google-maps-react';import PlayerMarker from'./PlayerMarker.js';import'./MapView.css';import PubNubReact from'pubnub-react';export var MapView=/*#__PURE__*/function(_React$Component){_inherits(MapView,_React$Component);var _super=_createSuper(MapView);function MapView(props){var _this;_classCallCheck(this,MapView);_this=_super.call(this,props);_this.state={myLocation:{lat:0,lng:0},targetLocation:{lat:0,lng:0}};_this.target=null;_this.publishMyLocation=function(loc){//console.log('this.props :>> ', this.state);\n//console.log('loc :>> ', loc);\n_this.pubnub.publish({message:{user:_this.props.user,userLocation:loc},channel:'positionChannel'});};_this.pubnub=new PubNubReact({publishKey:'pub-c-c72ffc95-6f42-4bdf-8a95-04015fd20d32',subscribeKey:'sub-c-ea26bb44-92b6-11ea-8dc6-429c98eb9bb1'});_this.pubnub.init(_assertThisInitialized(_this));return _this;}_createClass(MapView,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;window.onunload=function(){_this2.props.removePlayerFromGame(_this2.state.user);//TODO redirect to another component\n//enable user to get back in the game\n};window.onpopstate=function(){_this2.props.removePlayerFromGame(_this2.state.user);};console.log(\"MapView did mount\");this.pubnub.subscribe({channels:['positionChannel'],withPresence:true});// Listening to 'positionChannel'\nthis.pubnub.getMessage('positionChannel',function(msg){console.log('msg :>> ',msg,'\\nstate :>> ',_this2.state,'\\nProps: ',_this2.props);if(_this2.props.huntingPlayer.playerId===msg.message.user.playerId){_this2.setState({targetLocation:msg.message.userLocation});}console.log('from pubnub update this.state :>> ',_this2.state);});}},{key:\"componentDidUpdate\",value:function componentDidUpdate(previousProps){if(previousProps.huntingPlayer!==this.props.huntingPlayer)console.log('Current props: ',this.props);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.props.removePlayerFromGame(this.props.user);}},{key:\"render\",value:function render(){var _this3=this;if(!this.props.loaded)return/*#__PURE__*/React.createElement(\"div\",null,\"Loading...\");return/*#__PURE__*/React.createElement(Map,{google:this.props.google,zoom:14,initialCenter:{lat:59.329323,lng:18.068581},onClick:function onClick(props,map,e){_this3.setState({targetLocation:{lat:e.latLng.lat(),lng:e.latLng.lng()}});}},/*#__PURE__*/React.createElement(Marker,Object.assign({},this.props,{ref:function ref(element){if(element)_this3.target=element.marker;},name:'Target',position:this.state.targetLocation})),/*#__PURE__*/React.createElement(PlayerMarker,Object.assign({},this.props,{targetLocation:this.state.targetLocation,publishMyLocation:this.publishMyLocation// onChange={this.eventhandler}\n})));}}]);return MapView;}(React.Component);export default GoogleApiWrapper({apiKey:'AIzaSyD-HO6pALPiY9nrniME6UmHy3P3YUCv2Eg'})(MapView);","map":{"version":3,"sources":["/Users/Alessandro/Documents/GitHub/mobut-project/src/components/MapView.js"],"names":["React","Map","Marker","InfoWindow","GoogleApiWrapper","PlayerMarker","PubNubReact","MapView","props","state","myLocation","lat","lng","targetLocation","target","publishMyLocation","loc","pubnub","publish","message","user","userLocation","channel","publishKey","subscribeKey","init","window","onunload","removePlayerFromGame","onpopstate","console","log","subscribe","channels","withPresence","getMessage","msg","huntingPlayer","playerId","setState","previousProps","loaded","google","map","e","latLng","element","marker","Component","apiKey"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Map, Marker, InfoWindow, GoogleApiWrapper } from 'google-maps-react';\nimport PlayerMarker from './PlayerMarker.js';\nimport './MapView.css';\nimport PubNubReact from 'pubnub-react';\n\n\nexport class MapView extends React.Component {\n\n  state = {\n    myLocation: {\n      lat: 0,\n      lng: 0\n    },\n    targetLocation: {\n      lat: 0,\n      lng: 0\n    }\n  }\n  target = null;\n\n    constructor(props) {\n        super(props);\n        this.pubnub = new PubNubReact({\n            publishKey: 'pub-c-c72ffc95-6f42-4bdf-8a95-04015fd20d32',\n            subscribeKey: 'sub-c-ea26bb44-92b6-11ea-8dc6-429c98eb9bb1'\n        });\n        this.pubnub.init(this);\n    }\n\n  componentDidMount(){\n    window.onunload = () => {\n      this.props.removePlayerFromGame(this.state.user);\n      //TODO redirect to another component\n      //enable user to get back in the game\n    };\n    window.onpopstate = () => {\n        this.props.removePlayerFromGame(this.state.user);\n    };\n\n    console.log(\"MapView did mount\")\n      this.pubnub.subscribe({\n          channels: ['positionChannel'],\n          withPresence: true\n      });\n\n      // Listening to 'positionChannel'\n      this.pubnub.getMessage('positionChannel', (msg) => {\n          console.log('msg :>> ',\n              msg,\n              '\\nstate :>> ',\n              this.state,\n              '\\nProps: ',\n              this.props);\n          if (this.props.huntingPlayer.playerId === msg.message.user.playerId) {\n              this.setState({\n                  targetLocation: msg.message.userLocation,\n              })\n          }\n          console.log('from pubnub update this.state :>> ', this.state);\n      });\n  }\n\n    publishMyLocation = (loc) => {\n        //console.log('this.props :>> ', this.state);\n        //console.log('loc :>> ', loc);\n        this.pubnub.publish({\n            message: {\n                user: this.props.user,\n                userLocation: loc\n            },\n            channel: 'positionChannel'\n        });\n    }\n\n  componentDidUpdate(previousProps) {\n\n    if (previousProps.huntingPlayer !== this.props.huntingPlayer) console.log('Current props: ', this.props);\n  }\n\n  componentWillUnmount(){\n    this.props.removePlayerFromGame(this.props.user);\n  }\n\n  render() {\n    if (!this.props.loaded)\n      return (\n        <div>Loading...</div>\n      );\n\n    return (\n      <Map\n        google={this.props.google}\n        zoom={14}\n        initialCenter={{\n          lat: 59.329323,\n          lng: 18.068581\n        }}\n        onClick={(props, map, e) => {\n          this.setState({\n            targetLocation: {\n              lat: e.latLng.lat(),\n              lng: e.latLng.lng()\n            }\n          });\n        }}\n      >\n        <Marker {...this.props}\n          ref={element => {\n            if (element)\n              this.target = element.marker;\n          }}\n          name={'Target'}\n          position={this.state.targetLocation}\n        />\n        <PlayerMarker {...this.props}\n          targetLocation={this.state.targetLocation}\n          publishMyLocation={this.publishMyLocation}\n          // onChange={this.eventhandler}\n        />\n      </Map>\n    );\n  }\n}\n\nexport default GoogleApiWrapper({\n  apiKey: ('AIzaSyD-HO6pALPiY9nrniME6UmHy3P3YUCv2Eg')\n})(MapView)\n"]},"metadata":{},"sourceType":"module"}